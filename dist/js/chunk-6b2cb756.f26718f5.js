(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6b2cb756"],{"33ef":function(t,e,n){},"408a":function(t,e,n){var a=n("e330");t.exports=a(1..valueOf)},4331:function(t,e,n){"use strict";n("33ef")},5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,n){var a=n("e330"),i=n("1d80"),r=n("577e"),s=n("5899"),o=a("".replace),c="["+s+"]",l=RegExp("^"+c+c+"*"),d=RegExp(c+c+"*$"),u=function(t){return function(e){var n=r(i(e));return 1&t&&(n=o(n,l,"")),2&t&&(n=o(n,d,"")),n}};t.exports={start:u(1),end:u(2),trim:u(3)}},"8a4a":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",[n("div",{staticClass:"columns is-multiline has-text-centered"},[t._m(0),"undefined"!=t.token?n("div",{staticClass:"column is-12"},[n("Gantt",{attrs:{API_KEY:t.token}})],1):t._e()])])},i=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"column is-12"},[n("h1",{staticClass:"is-size-1"},[t._v("Gantt")])])}],r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{staticClass:"gantt"},[n("b-loading",{attrs:{"is-full-page":t.isFullPage,"can-cancel":!0},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}}),n("div",{staticClass:"column is-12"},[n("div",{staticClass:"columns multiline px-6 py-2"},[n("div",{staticClass:"column is-12-touch"},[n("div",{staticClass:"columns is-vcentered is-left has-text-left is-mobile"},[n("div",{staticClass:"column is-narrow"},[n("div",{staticClass:"field is-horizontal"},[n("label",{staticClass:"label pt-2"},[t._v("Affichage :  ")]),n("div",{staticClass:"control"},[n("div",{staticClass:"dropdown",class:t.showing},[n("div",{staticClass:"dropdown-trigger"},[n("button",{staticClass:"button",attrs:{"aria-haspopup":"true","aria-controls":"dropdown-menu"},on:{click:t.show}},[n("span",{staticClass:"icon-text"},[n("span",{staticClass:"icon"},[n("em",{staticClass:"fas fa-circle",style:{color:t.typeview.color}})]),n("span",[t._v(t._s(t.typeview.title))])]),t._m(0)])]),n("div",{staticClass:"dropdown-menu",attrs:{id:"dropdown-menu",role:"menu"}},[n("div",{staticClass:"dropdown-content"},[t._l(t.arrayFilter,(function(e,a){return n("a",{key:a,staticClass:"dropdown-item",attrs:{value:e.title},on:{click:function(n){return t.setView(e)}}},[n("span",{staticClass:"icon-text"},[n("span",{staticClass:"icon",style:{color:e.color}},[n("em",{staticClass:"fas fa-circle"})]),n("span",[t._v(t._s(e.title))])])])})),n("hr",{staticClass:"dropdown-divider"})],2)])])])])]),n("div",{staticClass:"column is-narrow"},[n("div",{staticClass:"field is-horizontal"},[n("label",{staticClass:"label pt-2"},[t._v("Utilisateurs :  ")]),n("div",{staticClass:"control"},[n("div",{staticClass:"select"},[n("multiselect",{attrs:{options:t.users,multiple:!0,"close-on-select":!1,"clear-on-select":!1,"preserve-search":!0,placeholder:"Selectionnez",label:"name","track-by":"name","preselect-first":!0},on:{close:t.dispatchAction},scopedSlots:t._u([{key:"selection",fn:function(e){var a=e.values,i=e.isOpen;return[a.length&&!i?n("span",{staticClass:"multiselect__single"},[t._v(t._s(a.length)+" selections")]):t._e()]}}]),model:{value:t.selectedUsers,callback:function(e){t.selectedUsers=e},expression:"selectedUsers"}})],1)])])]),n("div",{staticClass:"column is-narrow"},[n("div",{staticClass:"field is-horizontal"},[n("div",{staticClass:"control"},[n("div",{staticClass:"select"},[n("select",{directives:[{name:"model",rawName:"v-model",value:t.month_selected,expression:"month_selected"}],on:{change:[function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.month_selected=e.target.multiple?n:n[0]},t.updateStartDate]}},t._l(t.months,(function(e,a){return n("option",{key:a,domProps:{value:e}},[t._v(" "+t._s(e)+" ")])})),0)])])])]),n("div",{staticClass:"column is-narrow"},[n("div",{staticClass:"field is-horizontal"},[n("div",{staticClass:"control"},[n("div",{staticClass:"select"},[n("select",{directives:[{name:"model",rawName:"v-model",value:t.year_selected,expression:"year_selected"}],on:{change:[function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.year_selected=e.target.multiple?n:n[0]},t.updateStartDate]}},t._l([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],(function(e){return n("option",{key:e,domProps:{value:t.currentYear-e}},[t._v(" "+t._s(t.currentYear-e)+" ")])})),0)])])])])])])])]),n("DayPilotGantt",{ref:"gantt",attrs:{id:"dp",config:t.config}})],1)},s=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"icon is-small"},[n("i",{staticClass:"fas fa-angle-down",attrs:{"aria-hidden":"true"}})])}],o=n("2909"),c=n("1da1"),l=(n("96cf"),n("a9e3"),n("e9c4"),n("7db0"),n("d3b7"),n("d81d"),n("25f0"),n("4de4"),n("99af"),n("fb6a"),n("3ca3"),n("ddb0"),n("ac1f"),n("5319"),n("1276"),n("0d32")),d=n("bc3a"),u=n.n(d),f=n("c1df"),p=n.n(f),h=n("8e5f"),g=n.n(h),m=(n("e607"),{name:"Gantt",props:{API_KEY:{type:String,default:function(){return""}},URI:{type:String,default:function(){return"https://0002-zebridge-dev-externe.api.crm-simple.com/interactions/"}},URI_ACTION:{type:String,default:function(){return"https://0002-zebridge-dev-externe.api.crm-simple.com/interaction/"}},dataList:{type:Array,default:function(){return[]}},USER_API:{type:String,default:function(){return"https://0002-zebridge-dev-externe.api.crm-simple.com/utilisateurs/"}},arrayFilter:{type:Array,default:function(){return[{color:"#2251ff",title:"Défaut",index:"color_defaut"},{color:"#ffcedf0",title:"Etat",index:"color_etat"},{color:"#25ffcd",title:"Priorité",index:"color_priorite"},{color:"#de452a",title:"Utilisateur",index:"color_utilisateur"},{color:"#cdee00",title:"Type",index:"color_type"},{color:"#e19400",title:"Priorité échéance",index:"color_priorite_echeance"}]}},idUtilisateurs:{type:Array,default:function(){return["1","2","3","4","5","6","7","8","9"]}},idprojets:{type:Array,default:function(){return[]}},idcontacts:{type:Array,default:function(){return[]}},idsocietes:{type:Array,default:function(){return[]}},months:{type:Array,default:function(){return["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"]}},month_selected_number:{type:Number,default:function(){return(new Date).getMonth()}},month_selected:{type:String,default:function(){return this.months[this.month_selected_number]}},year_selected:{type:Number,default:function(){return(new Date).getFullYear()}}},data:function(){var t=this;return{isFullPage:!1,isLoading:!0,startDate:"",endDate:"",config:{cellWidthSpec:"Fixed",cellWidth:40,timeHeaders:[{groupBy:"Month",format:"MMMM yyyy"},{groupBy:"Week"},{groupBy:"Day",format:"d"}],scale:"Day",days:l["DayPilot"].Date.today().daysInYear(),startDate:l["DayPilot"].Date.today().firstDayOfMonth(),rowHeaderHideIconEnabled:!1,events:null,row:{bubbleHtml:"Row bubble"},columns:[{title:"Liste des tâches",width:50,property:"text"}],locale:"fr-fr",rowMoveHandling:"Disabled",onRowMoved:function(e){var n={},a={method:"put",url:t.URI_ACTION+t.API_KEY,headers:{"Content-Type":"application/json"},data:n};"child"===e.position?(n=JSON.stringify({idaction:e.kf.data.task.id,idaction_parent:e.lf.data.task.id}),a.data=n,u()(a).then((function(){t.gantt.tasks.update(e.e)}))):(n=JSON.stringify({idaction:e.kf.data.task.id,idaction_parent:null}),a.data=n,u()(a).then((function(){t.gantt.tasks.update(e.e)})))},taskMoveHandling:"Update",onTaskResized:function(e){t.updateTask(e)},onTaskMoved:function(e){t.updateTask(e)},linkCreateHandling:"Update",onLinkCreated:function(e){console.log("onLinkCreated",e);var n={},a={method:"put",url:t.URI_ACTION+t.API_KEY,headers:{"Content-Type":"application/json"},data:n},i=e.target.start().value,r=e.source.start().value;if(a.data=n,p()(i).isSameOrAfter(r))n=JSON.stringify({idaction:e.to,idaction_parent:e.from}),u()(a).then((function(){t.gantt.tasks.update(e.e)}));else{var s=t.gantt.links.findByFromTo(e.from,e.to);s&&t.gantt.links.remove(s)}},rowCreateHandling:"Enabled",onRowCreate:function(e){console.log("onRowCreate",e);var n=t,a=new Date,i=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds();i=p()(i).format("YYYY-MM-DD HH:mm:ss");var r=JSON.stringify({sujet:e.text,date_action:i,color:"#9e5fff",duree_heures:"24",duree_minutes:"00"}),s={method:"post",url:t.URI_ACTION+t.API_KEY,headers:{"Content-Type":"application/json"},data:r};u()(s).then((function(t){n.gantt.tasks.add({id:l["DayPilot"].guid(),text:e.text,start:(new l["DayPilot"].Date).getDatePart(),end:(new l["DayPilot"].Date).getDatePart().addDays(1),idaction:t.data.idaction})}))}},locale:"fr-FR",currentYear:"",gantt:null,users:[],selectedUsers:[],CscheduleList:[],showing:"",typeview:{title:"Selectionnez",color:"#2251ff",index:"color_defaut"}}},components:{DayPilotGantt:l["DayPilotGantt"],Multiselect:g.a},methods:{show:function(){this.showing=0===this.showing.length?"is-active":""},setView:function(t){this.typeview=t,this.show(),this.dispatchAction()},setColor:function(t,e){var n=t.color;try{var a=e.color.value;n=JSON.parse(a)[t.index]}catch(i){console.log("undefined color data")}return n},isUserSelected:function(t){return this.idUtilisateurs.find(t)>0},loadUsers:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,u()({method:"get",url:t.USER_API+t.API_KEY,headers:{"Content-Type":"application/json"}}).then((function(e){1===e.data.result?(t.users=e.data.data.map((function(t){return{id:t.idutilisateur.value.toString(),name:t.nom_utilisateur.value.toString()}})),t.selectedUsers=t.users.filter((function(e){return e.id in t.idUtilisateurs}))):console.log(e.data.err_message)})).catch((function(t){console.log(t)}));case 2:case"end":return e.stop()}}),e)})))()},generateQueryFor:function(t,e,n){return t.length>0&&(n=n.concat(0===n.length?"condition:":":separator:AND:condition:",this.setfilter(t,e))),n},setRenderRangeText:function(){var t=(this.months.indexOf(this.month_selected)+1).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1});this.startDate=this.year_selected+"-"+t+"-01",this.endDate=this.year_selected+"-"+t+"-31"},getQueryParam:function(){var t="";return this.selectedUsers.length>0&&(t=t.concat(0===t.length?"condition:":":separator:AND:condition:",this.setfilter(this.selectedUsers.map((function(t){return t.id})),"idutilisateur"))),this.idprojets.length>0&&(t=t.concat(0===t.length?"condition:":":separator:AND:condition:",this.setfilter(this.idprojets,"idprojet"))),this.idcontacts.length>0&&(t=t.concat(0===t.length?"condition:":":separator:AND:condition:",this.setfilter(this.idcontacts,"idcontact"))),this.idsocietes.length>0&&(t=t.concat(0===t.length?"condition:":":separator:AND:condition:",this.setfilter(this.idsocietes,"idsociete"))),t=t.concat(0===t.length?"condition:":":separator:AND:condition:","date_action:biggerthanoregal:"+this.startDate+":AND:date_action:lowerthanoregal:"+this.endDate),t},setfilter:function(t,e){return 1===t.length?e+":egal:"+t[0]:e+":egal:"+t[0]+":OR:"+this.setfilter(t.slice(1),e)},dispatchAction:function(){var t=this;this.isLoading=!0,this.loadTasks(0).then((function(e){var n=[];n=e.slice(0,e.length-1).map((function(e){return e.color=t.typeview.color,e.bgColor=t.typeview.color,0===e.idaction_parent&&(e.idaction_parent=""),e}));var a=n,i=t.loadLinks(n);t.CscheduleList=a,t.gantt.update({tasks:n}),t.gantt.update({links:i}),t.isLoading=!1}))},loadTasks:function(){var t=arguments,e=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){var a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=t.length>0&&void 0!==t[0]?t[0]:0,i=t.length>1&&void 0!==t[1]&&t[1],n.abrupt("return",u()({method:"get",url:e.URI+e.API_KEY+"/"+e.getQueryParam(i?"date_echeance":"date_action")+"/"+a,headers:{"Content-Type":"application/json"}}).then((function(t){if(t.data.data.length>0){var n=t.data.data.map((function(t){return{start:t.date_action.value,end:t.date_fin.value,text:t.sujet.value,id:t.idaction.value.toString(),complete:0,idaction_parent:t.idaction_parent,box:{backColor:"#e8eef7",barBackColor:i&&"color_priorite"!=e.typeview.index?"#f2a640":e.setColor(e.typeview,t)}}}));return Promise.all([].concat(Object(o["a"])(n),[e.loadTasks(++a,i)]))}return[]})).catch((function(){return[]})));case 3:case"end":return n.stop()}}),n)})))()},loadLinks:function(t){var e,n,a,i,r,s=t,o=[];for(n=0,a=s.length;n<a;n++)if(e=s[n],i=e.id,r=e.idaction_parent.value,r){var c=s.find((function(t){return t.id===r}));c&&(p()(c.start).isBefore(e.start)?o.push({from:r,to:i,type:"FinishToStart"}):p()(c.end).isAfter(e.end)?o.push({from:r,to:i,type:"StartToStart"}):o.push({from:r,to:i,type:"FinishToFinish"}))}return o},updateStartDate:function(){var t=(this.months.indexOf(this.month_selected)+1).toLocaleString("en-US",{minimumIntegerDigits:2,useGrouping:!1});this.config.startDate=this.year_selected+"-"+t+"-01",this.setRenderRangeText(),this.dispatchAction()},hierachiralTreeArray:function(t){var e,n,a,i,r,s=[],o={};for(e=t,a=0,i=e.length;a<i;a++)n=e[a],o[n.id]=n,r=o[n.idaction_parent.value],n.children=[];for(a=0,i=e.length;a<i;a++)n=e[a],r=o[n.idaction_parent.value],r?r.children.push(n):s.push(n);for(a=0,i=s.length;a<i;a++)n=s[a],0===n.children.length&&delete n.children;return s},updateTask:function(t){var e=this,n=new Date(t.newStart).toISOString();n=n.replace("T"," "),n=n.split(".")[0];var a=new Date(t.newEnd),i=new Date(t.newStart),r=a.getTime()-i.getTime(),s=Math.floor(r/36e5),o=r%36e5,c=Math.floor(o/6e4),l=JSON.stringify({idaction:t.task.data.id,date_action:n,duree_heures:s,duree_minutes:c}),d={method:"put",url:this.URI_ACTION+this.API_KEY,headers:{"Content-Type":"application/json"},data:l};u()(d).then((function(){e.gantt.tasks.update(t.e)}))}},mounted:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.setRenderRangeText(),t.gantt=t.$refs.gantt.control,t.month_selected_number=(new Date).getMonth(),t.month_selected=t.months[t.month_selected_number],t.year_selected=(new Date).getFullYear(),t.currentYear=t.year_selected,e.next=8,t.loadUsers();case 8:t.dispatchAction();case 9:case"end":return e.stop()}}),e)})))()}}),v=m,_=(n("4331"),n("0c7c")),y=Object(_["a"])(v,r,s,!1,null,"53d4a82e",null),w=y.exports,b={components:{Gantt:w},data:function(){return{token:this.$store.getters.getToken,loading:!1,datastored:this.$store.state.user}}},C=b,k=Object(_["a"])(C,a,i,!1,null,null,null);e["default"]=k.exports},a9e3:function(t,e,n){"use strict";var a=n("83ab"),i=n("da84"),r=n("e330"),s=n("94ca"),o=n("6eeb"),c=n("1a2d"),l=n("7156"),d=n("3a9b"),u=n("d9b5"),f=n("c04e"),p=n("d039"),h=n("241c").f,g=n("06cf").f,m=n("9bf2").f,v=n("408a"),_=n("58a8").trim,y="Number",w=i[y],b=w.prototype,C=i.TypeError,k=r("".slice),D=r("".charCodeAt),A=function(t){var e=f(t,"number");return"bigint"==typeof e?e:x(e)},x=function(t){var e,n,a,i,r,s,o,c,l=f(t,"number");if(u(l))throw C("Cannot convert a Symbol value to a number");if("string"==typeof l&&l.length>2)if(l=_(l),e=D(l,0),43===e||45===e){if(n=D(l,2),88===n||120===n)return NaN}else if(48===e){switch(D(l,1)){case 66:case 98:a=2,i=49;break;case 79:case 111:a=8,i=55;break;default:return+l}for(r=k(l,2),s=r.length,o=0;o<s;o++)if(c=D(r,o),c<48||c>i)return NaN;return parseInt(r,a)}return+l};if(s(y,!w(" 0o1")||!w("0b1")||w("+0x1"))){for(var I,S=function(t){var e=arguments.length<1?0:w(A(t)),n=this;return d(b,n)&&p((function(){v(n)}))?l(Object(e),n,S):e},N=a?h(w):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),T=0;N.length>T;T++)c(w,I=N[T])&&!c(S,I)&&m(S,I,g(w,I));S.prototype=b,b.constructor=S,o(i,y,S)}}}]);
//# sourceMappingURL=chunk-6b2cb756.f26718f5.js.map