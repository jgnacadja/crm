{"remainingRequest":"/home/jr/devspace/simpleCRM/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/jr/devspace/simpleCRM/src/components/agenda.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/jr/devspace/simpleCRM/src/components/agenda.vue","mtime":1643813077076},{"path":"/home/jr/devspace/simpleCRM/node_modules/@vue/cli-plugin-babel/node_modules/cache-loader/dist/cjs.js","mtime":1643224169106},{"path":"/home/jr/devspace/simpleCRM/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js","mtime":1643224169006},{"path":"/home/jr/devspace/simpleCRM/node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js","mtime":1643224169106},{"path":"/home/jr/devspace/simpleCRM/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1643224172087}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IENhbGVuZGFyIH0gZnJvbSAiQHRvYXN0LXVpL3Z1ZS1jYWxlbmRhciI7IC8qIEVTNiAqLwppbXBvcnQgInR1aS1jYWxlbmRhci9kaXN0L3R1aS1jYWxlbmRhci5jc3MiOwovLyBJZiB5b3UgdXNlIHRoZSBkZWZhdWx0IHBvcHVwcywgdXNlIHRoaXMuCmltcG9ydCAidHVpLWRhdGUtcGlja2VyL2Rpc3QvdHVpLWRhdGUtcGlja2VyLmNzcyI7CmltcG9ydCAidHVpLXRpbWUtcGlja2VyL2Rpc3QvdHVpLXRpbWUtcGlja2VyLmNzcyI7CgppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwoKaW1wb3J0IG1vbWVudCBmcm9tICJtb21lbnQiOwoKaW1wb3J0IG15VGhlbWUgZnJvbSAiLi9teVRoZW1lIjsKaW1wb3J0IE11bHRpc2VsZWN0IGZyb20gInZ1ZS1tdWx0aXNlbGVjdCI7CmltcG9ydCAidnVlLW11bHRpc2VsZWN0L2Rpc3QvdnVlLW11bHRpc2VsZWN0Lm1pbi5jc3MiOwoKaW1wb3J0IFZ1ZUZyaWVuZGx5SWZyYW1lIGZyb20gInZ1ZS1mcmllbmRseS1pZnJhbWUiOwovLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnMKY29uc3QgZ2V0RGF0ZSA9ICh0eXBlLCBzdGFydCwgdmFsdWUsIG9wZXJhdG9yKSA9PiB7CiAgc3RhcnQgPSBuZXcgRGF0ZShzdGFydCk7CiAgdHlwZSA9IHR5cGUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyB0eXBlLnNsaWNlKDEpOwogIGlmIChvcGVyYXRvciA9PT0gIisiKSB7CiAgICBzdGFydFtgc2V0JHt0eXBlfWBdKHN0YXJ0W2BnZXQke3R5cGV9YF0oKSArIHZhbHVlKTsKICB9IGVsc2UgewogICAgc3RhcnRbYHNldCR7dHlwZX1gXShzdGFydFtgZ2V0JHt0eXBlfWBdKCkgLSB2YWx1ZSk7CiAgfQogIHJldHVybiBzdGFydDsKfTsKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsgQ2FsZW5kYXIsIE11bHRpc2VsZWN0LCBWdWVGcmllbmRseUlmcmFtZSB9LAogIHByb3BzOiB7CiAgICBBUElfS0VZOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdCgpIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0sCiAgICB9LAoKICAgIFVSSTogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQoKSB7CiAgICAgICAgcmV0dXJuICJodHRwczovLzAwMDItemVicmlkZ2UtZGV2LWV4dGVybmUuYXBpLmNybS1zaW1wbGUuY29tL2ludGVyYWN0aW9ucy8iOwogICAgICB9LAogICAgfSwKCiAgICBVUklfSElTVE9SWTogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQoKSB7CiAgICAgICAgcmV0dXJuICJodHRwczovLzAwMDItemVicmlkZ2UtZGV2LWV4dGVybmUuYXBpLmNybS1zaW1wbGUuY29tL2ludGVyYWN0aW9uc2hpc3RvcmlxdWUvIjsKICAgICAgfSwKICAgIH0sCgogICAgVVJJX0FDVElPTjogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQoKSB7CiAgICAgICAgcmV0dXJuICJodHRwczovLzAwMDItemVicmlkZ2UtZGV2LWV4dGVybmUuYXBpLmNybS1zaW1wbGUuY29tL2ludGVyYWN0aW9uLyI7CiAgICAgIH0sCiAgICB9LAoKICAgIFVSSV9BQ1RJT05fQ1JFQVRJT046IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0KCkgewogICAgICAgIHJldHVybiAiaHR0cHM6Ly8wMDAyLXplYnJpZGdlLWRldi1leHRlcm5lLmNybS1zaW1wbGUuY29tL2FjdGlvbl9lZGl0LnBocCI7CiAgICAgIH0sCiAgICB9LAoKICAgIFVSSV9BQ1RJT05fVVBEQVRFOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdCgpIHsKICAgICAgICByZXR1cm4gImh0dHBzOi8vMDAwMi16ZWJyaWRnZS1kZXYtZXh0ZXJuZS5jcm0tc2ltcGxlLmNvbS9hY3Rpb25fZWRpdC5waHA/aWRhY3Rpb249IjsKICAgICAgfSwKICAgIH0sCgogICAgbG9jYWxlOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdCgpIHsKICAgICAgICByZXR1cm4gImZyLUZSIjsKICAgICAgfSwKICAgIH0sCgogICAgY2FsZW5kYXJMaXN0OiB7CiAgICAgIHR5cGU6IEFycmF5LAogICAgICBkZWZhdWx0KCkgewogICAgICAgIHJldHVybiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIGlkOiAiMCIsCiAgICAgICAgICAgIG5hbWU6ICJQcml2YXRlIiwKICAgICAgICAgICAgYmdDb2xvcjogIiM5ZTVmZmYiLAogICAgICAgICAgICBib3JkZXJDb2xvcjogIiM5ZTVmZmYiLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgaWQ6ICIxIiwKICAgICAgICAgICAgbmFtZTogIkNvbXBhbnkiLAogICAgICAgICAgICBiZ0NvbG9yOiAiIzAwYTlmZiIsCiAgICAgICAgICAgIGJvcmRlckNvbG9yOiAiIzAwYTlmZiIsCiAgICAgICAgICB9LAogICAgICAgIF07CiAgICAgIH0sCiAgICB9LAogICAgVVNFUl9BUEk6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0KCkgewogICAgICAgIHJldHVybiAiaHR0cHM6Ly8wMDAyLXplYnJpZGdlLWRldi1leHRlcm5lLmFwaS5jcm0tc2ltcGxlLmNvbS91dGlsaXNhdGV1cnMvIjsKICAgICAgfSwKICAgIH0sCiAgICBhcnJheUZpbHRlcjogewogICAgICB0eXBlOiBBcnJheSwKICAgICAgZGVmYXVsdCgpIHsKICAgICAgICByZXR1cm4gWwogICAgICAgICAgewogICAgICAgICAgICBjb2xvcjogIiMyMjUxZmYiLAogICAgICAgICAgICB0aXRsZTogIkTDqWZhdXQiLAogICAgICAgICAgICBpbmRleDogImNvbG9yX2RlZmF1dCIsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBjb2xvcjogIiNmZmNlZGYwIiwKICAgICAgICAgICAgdGl0bGU6ICJFdGF0IiwKICAgICAgICAgICAgaW5kZXg6ICJjb2xvcl9ldGF0IiwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbG9yOiAiIzI1ZmZjZCIsCiAgICAgICAgICAgIHRpdGxlOiAiUHJpb3JpdMOpIiwKICAgICAgICAgICAgaW5kZXg6ICJjb2xvcl9wcmlvcml0ZSIsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBjb2xvcjogIiNkZTQ1MmEiLAogICAgICAgICAgICB0aXRsZTogIlV0aWxpc2F0ZXVyIiwKICAgICAgICAgICAgaW5kZXg6ICJjb2xvcl91dGlsaXNhdGV1ciIsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBjb2xvcjogIiNjZGVlMDAiLAogICAgICAgICAgICB0aXRsZTogIlR5cGUiLAogICAgICAgICAgICBpbmRleDogImNvbG9yX3R5cGUiLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgY29sb3I6ICIjZTE5NDAwIiwKICAgICAgICAgICAgdGl0bGU6ICJQcmlvcml0w6kgw6ljaMOpYW5jZSIsCiAgICAgICAgICAgIGluZGV4OiAiY29sb3JfcHJpb3JpdGVfZWNoZWFuY2UiLAogICAgICAgICAgfSwKICAgICAgICBdOwogICAgICB9LAogICAgfSwKICAgIGlkVXRpbGlzYXRldXJzOiB7CiAgICAgIHR5cGU6IEFycmF5LAogICAgICBkZWZhdWx0KCkgewogICAgICAgIHJldHVybiBbIjEiLCAiMiIsICIzIiwgIjQiLCAiNSIsICI2IiwgIjciLCAiOCIsICI5Il07CiAgICAgIH0sCiAgICB9LAogICAgaWRwcm9qZXRzOiB7CiAgICAgIHR5cGU6IEFycmF5LAogICAgICBkZWZhdWx0KCkgewogICAgICAgIHJldHVybiBbXTsKICAgICAgfSwKICAgIH0sCiAgICBpZGNvbnRhY3RzOiB7CiAgICAgIHR5cGU6IEFycmF5LAogICAgICBkZWZhdWx0KCkgewogICAgICAgIHJldHVybiBbXTsKICAgICAgfSwKICAgIH0sCiAgICBpZHNvY2lldGVzOiB7CiAgICAgIHR5cGU6IEFycmF5LAogICAgICBkZWZhdWx0KCkgewogICAgICAgIHJldHVybiBbXTsKICAgICAgfSwKICAgIH0sCiAgICBzY2hlZHVsZUxpc3Q6IHsKICAgICAgdHlwZTogQXJyYXksCiAgICAgIGRlZmF1bHQoKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9LAogICAgfSwKICAgIHZpZXdNb2RlT3B0aW9uczogewogICAgICB0eXBlOiBBcnJheSwKICAgICAgZGVmYXVsdCgpIHsKICAgICAgICByZXR1cm4gWwogICAgICAgICAgewogICAgICAgICAgICB0aXRsZTogIk1vaXMiLAogICAgICAgICAgICB2YWx1ZTogIm1vbnRoIiwKICAgICAgICAgIH0sCiAgICAgICAgICB7CiAgICAgICAgICAgIHRpdGxlOiAiU2VtYWluZSIsCiAgICAgICAgICAgIHZhbHVlOiAid2VlayIsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICB0aXRsZTogIkpvdXIiLAogICAgICAgICAgICB2YWx1ZTogImRheSIsCiAgICAgICAgICB9LAogICAgICAgIF07CiAgICAgIH0sCiAgICB9LAoKICAgIGRhdGVSYW5nZTogewogICAgICB0eXBlOiBBcnJheSwKICAgICAgZGVmYXVsdCgpIHsKICAgICAgICByZXR1cm4gW21vbWVudCgpLnN1YnRyYWN0KDEsICJtb250aCIpLnRvRGF0ZSgpLCBtb21lbnQoKS50b0RhdGUoKV07CiAgICAgIH0sCiAgICB9LAoKICAgIHRpbWV6b25lczogewogICAgICB0eXBlOiBBcnJheSwKICAgICAgZGVmYXVsdCgpIHsKICAgICAgICByZXR1cm4gWwogICAgICAgICAgLy8gcGFyaXMKICAgICAgICAgIHsKICAgICAgICAgICAgbmFtZTogIkV1cm9wZS9QYXJpcyIsCiAgICAgICAgICAgIGxhYmVsOiAiUGFyaXMiLAogICAgICAgICAgICBvZmZzZXQ6ICIrMDE6MDAiLAogICAgICAgICAgfSwKICAgICAgICBdOwogICAgICB9LAogICAgfSwKCiAgICBtb250aDogewogICAgICB0eXBlOiBPYmplY3QsCiAgICAgIGRlZmF1bHQoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHN0YXJ0RGF5T2ZXZWVrOiAxLAogICAgICAgICAgZGF5bmFtZXM6IFsiRGltIiwgIkx1biIsICJNYXIiLCAiTWVyIiwgIkpldSIsICJWZW4iLCAiU2FtIl0sCiAgICAgICAgfTsKICAgICAgfSwKICAgIH0sCgogICAgd2VlazogewogICAgICB0eXBlOiBPYmplY3QsCiAgICAgIGRlZmF1bHQoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHNob3dUaW1lem9uZUNvbGxhcHNlQnV0dG9uOiB0cnVlLAogICAgICAgICAgdGltZXpvbmVzQ29sbGFwc2VkOiB0cnVlLAogICAgICAgICAgZGF5bmFtZXM6IFsiRGltIiwgIkx1biIsICJNYXIiLCAiTWVyIiwgIkpldSIsICJWZW4iLCAiU2FtIl0sCiAgICAgICAgICBzdGFydERheU9mV2VlazogMSwKICAgICAgICB9OwogICAgICB9LAogICAgfSwKCiAgICB0YXNrVmlldzogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0KCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9LAogICAgfSwKCiAgICBzY2hlZHVsZVZpZXc6IHsKICAgICAgdHlwZTogQXJyYXksCiAgICAgIGRlZmF1bHQoKSB7CiAgICAgICAgcmV0dXJuIFsidGltZSJdOwogICAgICB9LAogICAgfSwKCiAgICBkaXNhYmxlRGJsQ2xpY2s6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdCgpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSwKICAgIH0sCgogICAgaXNSZWFkT25seTogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0KCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSwKICAgIH0sCgogICAgLy8gdmlldzogewogICAgLy8gICB0eXBlOiBTdHJpbmcsCiAgICAvLyAgIGRlZmF1bHQoKSB7CiAgICAvLyAgICAgcmV0dXJuICJtb250aCI7CiAgICAvLyAgIH0sCiAgICAvLyB9LAogICAgdXNlQ3JlYXRpb25Qb3B1cDogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0KCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSwKICAgIH0sCiAgICB1c2VEZXRhaWxQb3B1cDogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0KCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSwKICAgIH0sCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdXNlcnM6IFtdLAogICAgICBzZWxlY3RlZFVzZXJzOiBbXSwKICAgICAgZWRpdGluZzogZmFsc2UsCiAgICAgIGhpc3Rvcnk6IGZhbHNlLAogICAgICBjcmVhdGluZzogZmFsc2UsCiAgICAgIGNsaWNrQ291bnQ6IDAsCiAgICAgIHNlbGVjdGVkOiBudWxsLAogICAgICBpc0Z1bGxQYWdlOiBmYWxzZSwKICAgICAgaXNMb2FkaW5nOiB0cnVlLAogICAgICBpbmZvOiBudWxsLAogICAgICBldmVudDogbnVsbCwKICAgICAgdmlldzogIm1vbnRoIiwKICAgICAgaXNDb21wb25lbnRNb2RhbEFjdGl2ZTogZmFsc2UsCiAgICAgIHJlbmRlclJhbmdlOiBudWxsLAogICAgICBzdGFydERhdGU6ICIiLAogICAgICBlbmREYXRlOiAiIiwKICAgICAgZGF0ZUNyZWF0ZUV2ZW50OiAiIiwKICAgICAgZm9ybTogewogICAgICAgIHN1amV0OiAiIiwKICAgICAgICBjb2xvcjogIiIsCiAgICAgICAgZGF0ZV9kZWJ1dDogIiIsCiAgICAgICAgZGF0ZV9maW46ICIiLAoKICAgICAgICBzdWJtaXQ6IGZhbHNlLAogICAgICB9LAogICAgICBlcnJvcnM6IHsKICAgICAgICBzdWpldDogIkxlIGNoYW1wcyB0aXRyZSBlc3Qgb2JsaWdhdG9pcmUiLAogICAgICAgIGRhdGVfZGVidXQ6ICJMZSBkYXRlIGRlYnV0IGVzdCBvYmxpZ2F0b2lyZSIsCiAgICAgICAgZGF0ZV9maW46ICJMZSBkYXRlIGZpbiBlc3Qgb2JsaWdhdG9pcmUiLAogICAgICAgIGNvbG9yOiAiTGUgY2hhbXBzIGNvdWxldXIgZXN0IG9ibGlnYXRvaXJlIiwKICAgICAgfSwKICAgICAgdGVtcGxhdGU6IHRoaXMuZ2V0VGVtcGxhdGUoKSwKICAgICAgdGhlbWU6IG15VGhlbWUsCiAgICAgIENzY2hlZHVsZUxpc3Q6IFtdLAogICAgICBzaG93aW5nOiAiIiwKICAgICAgdHlwZXZpZXc6IHsKICAgICAgICB0aXRsZTogIlNlbGVjdGlvbm5leiIsCiAgICAgICAgY29sb3I6ICIjMjI1MWZmIiwKICAgICAgICBpbmRleDogImNvbG9yX2RlZmF1dCIsCiAgICAgIH0sCiAgICB9OwogIH0sCgogIG1ldGhvZHM6IHsKICAgIHNob3coKSB7CiAgICAgIHRoaXMuc2hvd2luZyA9IHRoaXMuc2hvd2luZy5sZW5ndGggPT09IDAgPyAiaXMtYWN0aXZlIiA6ICIiOwogICAgfSwKCiAgICBzZXRWaWV3KHR5cGUpIHsKICAgICAgdGhpcy50eXBldmlldyA9IHR5cGU7CiAgICAgIHRoaXMuc2hvdygpOyAvLyBzaG93IG9yIGhpZGUgdGhlIGRyb3Bkb3duCgogICAgICB0aGlzLmRpc3BhdGNoQWN0aW9uKCk7CiAgICB9LAogICAgaXNVc2VyU2VsZWN0ZWQoaWRVc2VyKSB7CiAgICAgIHJldHVybiB0aGlzLmlkVXRpbGlzYXRldXJzLmZpbmQoaWRVc2VyKSA+IDA7CiAgICB9LAogICAgYXN5bmMgbG9hZFVzZXJzKCkgewogICAgICBhd2FpdCBheGlvcyh7CiAgICAgICAgbWV0aG9kOiAiZ2V0IiwKICAgICAgICB1cmw6IHRoaXMuVVNFUl9BUEkgKyB0aGlzLkFQSV9LRVksCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICB9LAogICAgICB9KQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucmVzdWx0ID09PSAxKSB7CiAgICAgICAgICAgIHRoaXMudXNlcnMgPSByZXNwb25zZS5kYXRhLmRhdGEubWFwKChlbCkgPT4gewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBpZDogZWwuaWR1dGlsaXNhdGV1ci52YWx1ZS50b1N0cmluZygpLAogICAgICAgICAgICAgICAgbmFtZTogZWwubm9tX3V0aWxpc2F0ZXVyLnZhbHVlLnRvU3RyaW5nKCksCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRVc2VycyA9IHRoaXMudXNlcnMuZmlsdGVyKAogICAgICAgICAgICAgICh4KSA9PiB4LmlkIGluIHRoaXMuaWRVdGlsaXNhdGV1cnMKICAgICAgICAgICAgKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEuZXJyX21lc3NhZ2UpOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlcnIpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7CiAgICAgICAgfSk7CiAgICB9LAogICAgYXN5bmMgZGlzcGF0Y2hBY3Rpb24oKSB7CiAgICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTsKCiAgICAgIC8vIGNhbGxpbmYgZmlzcnQgcm91dGUKICAgICAgdGhpcy5Dc2NoZWR1bGVMaXN0ID0gYXdhaXQgdGhpcy5nZXRDYWxlbmRhckl0ZW0oMCwgZmFsc2UpLnRoZW4oCiAgICAgICAgKGl0ZW1zKSA9PiB7CiAgICAgICAgICByZXR1cm4gaXRlbXMuZmxhdChJbmZpbml0eSk7CiAgICAgICAgfQogICAgICApOwoKICAgICAgLy8gMiByb3V0ZSBvbkR1ZURhdGUgaXMgdHJ1ZQogICAgICB0aGlzLkNzY2hlZHVsZUxpc3QgPSB0aGlzLkNzY2hlZHVsZUxpc3QuY29uY2F0KAogICAgICAgIGF3YWl0IHRoaXMuZ2V0Q2FsZW5kYXJJdGVtKDAsIHRydWUpLnRoZW4oKGl0ZW1zKSA9PiB7CiAgICAgICAgICByZXR1cm4gaXRlbXMuZmxhdChJbmZpbml0eSk7CiAgICAgICAgfSkKICAgICAgKTsKCiAgICAgIC8vIGNhbGxpbmcgdGhpcmQgcm91dGUKICAgICAgaWYgKHRoaXMuaGlzdG9yeSkgewogICAgICAgIHRoaXMuQ3NjaGVkdWxlTGlzdCA9IHRoaXMuQ3NjaGVkdWxlTGlzdC5jb25jYXQoCiAgICAgICAgICBhd2FpdCB0aGlzLmdldEl0ZXJhY3Rpb25zSGlzdG9yeSgwKS50aGVuKChoaXN0b3J5SXRlbXMpID0+IHsKICAgICAgICAgICAgcmV0dXJuIGhpc3RvcnlJdGVtcy5mbGF0KEluZmluaXR5KTsKICAgICAgICAgIH0pCiAgICAgICAgKTsKICAgICAgfQogICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlOwogICAgfSwKCiAgICBzZXRDb2xvcih0eXBlLCBkYXRhKSB7CiAgICAgIGxldCBjb2xvciA9IHR5cGUuY29sb3I7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QganNvbmRhdGEgPSBkYXRhLmNvbG9yLnZhbHVlOwogICAgICAgIGNvbG9yID0gSlNPTi5wYXJzZShqc29uZGF0YSlbdHlwZS5pbmRleF07CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5sb2coInVuZGVmaW5lZCBjb2xvciBkYXRhIik7CiAgICAgIH0KCiAgICAgIHJldHVybiBjb2xvcjsKICAgIH0sCiAgICBnZXRUZW1wbGF0ZSgpIHsKICAgICAgY29uc3QgdGggPSB0aGlzOwogICAgICByZXR1cm4gewogICAgICAgIG1pbGVzdG9uZTogZnVuY3Rpb24gKHNjaGVkdWxlKSB7CiAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAnPHNwYW4gY2xhc3M9ImNhbGVuZGFyLWZvbnQtaWNvbiBpYy1taWxlc3RvbmUtYiI+PC9zcGFuPiA8c3BhbiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogJyArCiAgICAgICAgICAgIHNjaGVkdWxlLmJnQ29sb3IgKwogICAgICAgICAgICAnIj4nICsKICAgICAgICAgICAgc2NoZWR1bGUudGl0bGUgKwogICAgICAgICAgICAiPC9zcGFuPiIKICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICBtaWxlc3RvbmVUaXRsZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz0idHVpLWZ1bGwtY2FsZW5kYXItbGVmdC1jb250ZW50Ij5FVEFQRTwvc3Bhbj4nOwogICAgICAgIH0sCiAgICAgICAgdGFzazogZnVuY3Rpb24gKHNjaGVkdWxlKSB7CiAgICAgICAgICByZXR1cm4gIiMiICsgc2NoZWR1bGUudGl0bGU7CiAgICAgICAgfSwKICAgICAgICB0YXNrVGl0bGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9InR1aS1mdWxsLWNhbGVuZGFyLWxlZnQtY29udGVudCI+VEFDSEU8L3NwYW4+JzsKICAgICAgICB9LAogICAgICAgIGFsbGRheTogZnVuY3Rpb24gKHNjaGVkdWxlKSB7CiAgICAgICAgICByZXR1cm4gdGguX2dldFRpbWVUZW1wbGF0ZShzY2hlZHVsZSwgdHJ1ZSk7CiAgICAgICAgfSwKICAgICAgICBhbGxkYXlUaXRsZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz0idHVpLWZ1bGwtY2FsZW5kYXItbGVmdC1jb250ZW50Ij4gVG91dGUgbGEgam91cm7DqWU8L3NwYW4+JzsKICAgICAgICB9LAogICAgICAgIHRpbWU6IGZ1bmN0aW9uIChzY2hlZHVsZSkgewogICAgICAgICAgcmV0dXJuIHRoLl9nZXRUaW1lVGVtcGxhdGUoc2NoZWR1bGUsIGZhbHNlKTsKICAgICAgICB9LAogICAgICAgIGdvaW5nRHVyYXRpb246IGZ1bmN0aW9uIChzY2hlZHVsZSkgewogICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgJzxzcGFuIGNsYXNzPSJjYWxlbmRhci1pY29uIGljLXRyYXZlbC10aW1lIj48L3NwYW4+JyArCiAgICAgICAgICAgIHNjaGVkdWxlLmdvaW5nRHVyYXRpb24gKwogICAgICAgICAgICAibWluLiIKICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICBjb21pbmdEdXJhdGlvbjogZnVuY3Rpb24gKHNjaGVkdWxlKSB7CiAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAnPHNwYW4gY2xhc3M9ImNhbGVuZGFyLWljb24gaWMtdHJhdmVsLXRpbWUiPjwvc3Bhbj4nICsKICAgICAgICAgICAgc2NoZWR1bGUuY29taW5nRHVyYXRpb24gKwogICAgICAgICAgICAibWluLiIKICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICBtb250aE1vcmVUaXRsZURhdGU6IGZ1bmN0aW9uIChkYXRlLCBkYXluYW1lKSB7CiAgICAgICAgICB2YXIgZGF5ID0gZGF0ZS5zcGxpdCgiLiIpWzJdOwoKICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICc8c3BhbiBjbGFzcz0idHVpLWZ1bGwtY2FsZW5kYXItbW9udGgtbW9yZS10aXRsZS1kYXkiPicgKwogICAgICAgICAgICBkYXkgKwogICAgICAgICAgICAnPC9zcGFuPiA8c3BhbiBjbGFzcz0idHVpLWZ1bGwtY2FsZW5kYXItbW9udGgtbW9yZS10aXRsZS1kYXktbGFiZWwiPicgKwogICAgICAgICAgICBkYXluYW1lICsKICAgICAgICAgICAgIjwvc3Bhbj4iCiAgICAgICAgICApOwogICAgICAgIH0sCiAgICAgICAgbW9udGhNb3JlQ2xvc2U6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9InR1aS1mdWxsLWNhbGVuZGFyLWljb24gdHVpLWZ1bGwtY2FsZW5kYXItaWMtY2xvc2UiPjwvc3Bhbj4nOwogICAgICAgIH0sCiAgICAgICAgbW9udGhHcmlkSGVhZGVyOiBmdW5jdGlvbiAoZGF5TW9kZWwpIHsKICAgICAgICAgIHZhciBkYXRlID0gcGFyc2VJbnQoZGF5TW9kZWwuZGF0ZS5zcGxpdCgiLSIpWzJdLCAxMCk7CiAgICAgICAgICB2YXIgY2xhc3NOYW1lcyA9IFsidHVpLWZ1bGwtY2FsZW5kYXItd2Vla2RheS1ncmlkLWRhdGUgIl07CgogICAgICAgICAgaWYgKGRheU1vZGVsLmlzVG9kYXkpIHsKICAgICAgICAgICAgY2xhc3NOYW1lcy5wdXNoKCJ0dWktZnVsbC1jYWxlbmRhci13ZWVrZGF5LWdyaWQtZGF0ZS1kZWNvcmF0b3IiKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAnPHNwYW4gY2xhc3M9IicgKyBjbGFzc05hbWVzLmpvaW4oIiAiKSArICciPicgKyBkYXRlICsgIjwvc3Bhbj4iCiAgICAgICAgICApOwogICAgICAgIH0sCiAgICAgICAgbW9udGhHcmlkSGVhZGVyRXhjZWVkOiBmdW5jdGlvbiAoaGlkZGVuU2NoZWR1bGVzKSB7CiAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAnPHNwYW4gY2xhc3M9IndlZWtkYXktZ3JpZC1tb3JlLXNjaGVkdWxlcyI+KycgKwogICAgICAgICAgICBoaWRkZW5TY2hlZHVsZXMgKwogICAgICAgICAgICAiPC9zcGFuPiIKICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICBtb250aEdyaWRGb290ZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiAiIjsKICAgICAgICB9LAogICAgICAgIG1vbnRoR3JpZEZvb3RlckV4Y2VlZDogZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIH0sCiAgICAgICAgbW9udGhEYXluYW1lOiBmdW5jdGlvbiAobW9kZWwpIHsKICAgICAgICAgIHJldHVybiBtb2RlbC5sYWJlbC50b1N0cmluZygpLnRvTG9jYWxlVXBwZXJDYXNlKCk7CiAgICAgICAgfSwKICAgICAgICB3ZWVrRGF5bmFtZTogZnVuY3Rpb24gKG1vZGVsKSB7CiAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAnPHNwYW4gY2xhc3M9InR1aS1mdWxsLWNhbGVuZGFyLWRheW5hbWUtZGF0ZSI+JyArCiAgICAgICAgICAgIG1vZGVsLmRhdGUgKwogICAgICAgICAgICAnPC9zcGFuPiZuYnNwOyZuYnNwOzxzcGFuIGNsYXNzPSJ0dWktZnVsbC1jYWxlbmRhci1kYXluYW1lLW5hbWUiPicgKwogICAgICAgICAgICBtb2RlbC5kYXlOYW1lICsKICAgICAgICAgICAgIjwvc3Bhbj4iCiAgICAgICAgICApOwogICAgICAgIH0sCiAgICAgICAgd2Vla0dyaWRGb290ZXJFeGNlZWQ6IGZ1bmN0aW9uIChoaWRkZW5TY2hlZHVsZXMpIHsKICAgICAgICAgIHJldHVybiAiKyIgKyBoaWRkZW5TY2hlZHVsZXM7CiAgICAgICAgfSwKICAgICAgICBkYXlHcmlkVGl0bGU6IGZ1bmN0aW9uICh2aWV3TmFtZSkgewogICAgICAgICAgLy8gdXNlIGFub3RoZXIgZnVuY3Rpb25zIGluc3RlYWQgb2YgJ2RheUdyaWRUaXRsZScKICAgICAgICAgIC8vIG1pbGVzdG9uZVRpdGxlOiBmdW5jdGlvbigpIHsuLi59CiAgICAgICAgICAvLyB0YXNrVGl0bGU6IGZ1bmN0aW9uKCkgey4uLn0KICAgICAgICAgIC8vIGFsbGRheVRpdGxlOiBmdW5jdGlvbigpIHsuLi59CgogICAgICAgICAgdmFyIHRpdGxlID0gIiI7CiAgICAgICAgICBzd2l0Y2ggKHZpZXdOYW1lKSB7CiAgICAgICAgICAgIGNhc2UgIm1pbGVzdG9uZSI6CiAgICAgICAgICAgICAgdGl0bGUgPQogICAgICAgICAgICAgICAgJzxzcGFuIGNsYXNzPSJ0dWktZnVsbC1jYWxlbmRhci1sZWZ0LWNvbnRlbnQiPkVUQVBFPC9zcGFuPic7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgInRhc2siOgogICAgICAgICAgICAgIHRpdGxlID0KICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz0idHVpLWZ1bGwtY2FsZW5kYXItbGVmdC1jb250ZW50Ij5UQUNIRTwvc3Bhbj4nOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICJhbGxkYXkiOgogICAgICAgICAgICAgIHRpdGxlID0KICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz0idHVpLWZ1bGwtY2FsZW5kYXItbGVmdC1jb250ZW50Ij5Ub3V0ZSBsYSBqb3VybsOpZTwvc3Bhbj4nOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiB0aXRsZTsKICAgICAgICB9LAoKICAgICAgICBjb2xsYXBzZUJ0blRpdGxlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gJzxzcGFuIGNsYXNzPSJ0dWktZnVsbC1jYWxlbmRhci1pY29uIHR1aS1mdWxsLWNhbGVuZGFyLWljLWFycm93LXNvbGlkLXRvcCI+PC9zcGFuPic7CiAgICAgICAgfSwKCiAgICAgICAgdGltZWdyaWREaXNwbGF5UHJpbWF5VGltZTogZnVuY3Rpb24gKHRpbWUpIHsKICAgICAgICAgIC8vIHdpbGwgYmUgZGVwcmVjYXRlZC4gdXNlICd0aW1lZ3JpZERpc3BsYXlQcmltYXJ5VGltZScKICAgICAgICAgIHJldHVybiB0aW1lLmhvdXIudG9TdHJpbmcoKTsKICAgICAgICB9LAogICAgICAgIHRpbWVncmlkQ3VycmVudFRpbWU6IGZ1bmN0aW9uICh0aW1lem9uZSkgewogICAgICAgICAgdmFyIHRlbXBsYXRlcyA9IFtdOwoKICAgICAgICAgIGlmICh0aW1lem9uZS5kYXRlRGlmZmVyZW5jZSkgewogICAgICAgICAgICB0ZW1wbGF0ZXMucHVzaCgKICAgICAgICAgICAgICAiWyIgKwogICAgICAgICAgICAgICAgdGltZXpvbmUuZGF0ZURpZmZlcmVuY2VTaWduICsKICAgICAgICAgICAgICAgIHRpbWV6b25lLmRhdGVEaWZmZXJlbmNlICsKICAgICAgICAgICAgICAgICJdPGJyPiIKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KCiAgICAgICAgICB0ZW1wbGF0ZXMucHVzaChtb21lbnQodGltZXpvbmUuaG91cm1hcmtlcikuZm9ybWF0KCJISDptbSIpKTsKCiAgICAgICAgICByZXR1cm4gdGVtcGxhdGVzLmpvaW4oIiIpOwogICAgICAgIH0sCiAgICAgICAgcG9wdXBJc0FsbERheTogZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuICJUb3V0ZSBsYSBqb3VybsOpZSI7CiAgICAgICAgfSwKICAgICAgICBwb3B1cFN0YXRlRnJlZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuICJMaWJyZSI7CiAgICAgICAgfSwKICAgICAgICBwb3B1cFN0YXRlQnVzeTogZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuICJPY2N1cMOpIjsKICAgICAgICB9LAogICAgICAgIHRpdGxlUGxhY2Vob2xkZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiAiU3VqZXQiOwogICAgICAgIH0sCiAgICAgICAgbG9jYXRpb25QbGFjZWhvbGRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuICJMaWV1IjsKICAgICAgICB9LAogICAgICAgIHN0YXJ0RGF0ZVBsYWNlaG9sZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gIkRhdGUgZGUgRMOpYnV0IjsKICAgICAgICB9LAogICAgICAgIGVuZERhdGVQbGFjZWhvbGRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuICJEYXRlIGRlIGZpbiI7CiAgICAgICAgfSwKICAgICAgICBwb3B1cFNhdmU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiAiVmFsaWRlciI7CiAgICAgICAgfSwKICAgICAgICBwb3B1cFVwZGF0ZTogZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuICJNZXR0cmUgw6Agam91ciI7CiAgICAgICAgfSwKICAgICAgICBwb3B1cERldGFpbERhdGU6IGZ1bmN0aW9uIChpc0FsbERheSwgc3RhcnQsIGVuZCkgewogICAgICAgICAgdmFyIGlzU2FtZURhdGUgPSBtb21lbnQoc3RhcnQpLmlzU2FtZShlbmQpOwogICAgICAgICAgdmFyIGVuZEZvcm1hdCA9IChpc1NhbWVEYXRlID8gIiIgOiAiWVlZWS9NTS9ERCAiKSArICJISDptbSI7CgogICAgICAgICAgaWYgKGlzQWxsRGF5KSB7CiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgbW9tZW50KHN0YXJ0KS5mb3JtYXQoIllZWVkvTU0vREQiKSArCiAgICAgICAgICAgICAgKGlzU2FtZURhdGUgPyAiIiA6ICIgLSAiICsgbW9tZW50KGVuZCkuZm9ybWF0KCJZWVlZL01NL0REIikpCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgbW9tZW50KHN0YXJ0LnRvRGF0ZSgpKS5mb3JtYXQoIllZWVkvTU0vREQgSEg6bW0iKSArCiAgICAgICAgICAgICIgLSAiICsKICAgICAgICAgICAgbW9tZW50KGVuZC50b0RhdGUoKSkuZm9ybWF0KGVuZEZvcm1hdCkKICAgICAgICAgICk7CiAgICAgICAgfSwKICAgICAgICBwb3B1cERldGFpbExvY2F0aW9uOiBmdW5jdGlvbiAoc2NoZWR1bGUpIHsKICAgICAgICAgIHJldHVybiAiTGlldSA6ICIgKyBzY2hlZHVsZS5sb2NhdGlvbjsKICAgICAgICB9LAogICAgICAgIC8vIHBvcHVwRGV0YWlsVXNlcjogZnVuY3Rpb24gKHNjaGVkdWxlKSB7CiAgICAgICAgLy8gCXJldHVybiAnU3RhZmYgOiAnICsgKHNjaGVkdWxlLmF0dGVuZGVlcyB8fCBbXSkuam9pbignLCAnKQogICAgICAgIC8vIH0sCiAgICAgICAgcG9wdXBEZXRhaWxTdGF0ZTogZnVuY3Rpb24gKHNjaGVkdWxlKSB7CiAgICAgICAgICByZXR1cm4gIiBTdGF0dXQ6ICIgKyBzY2hlZHVsZS5zdGF0ZSA9PT0gIkZyZWUiID8gIkxpYnJlIiA6ICJPY2N1cMOpIjsKICAgICAgICB9LAogICAgICAgIHBvcHVwRGV0YWlsUmVwZWF0OiBmdW5jdGlvbiAoc2NoZWR1bGUpIHsKICAgICAgICAgIHJldHVybiAiUmVwZWF0IDogIiArIHNjaGVkdWxlLnJlY3VycmVuY2VSdWxlOwogICAgICAgIH0sCiAgICAgICAgcG9wdXBEZXRhaWxCb2R5OiBmdW5jdGlvbiAoc2NoZWR1bGUpIHsKICAgICAgICAgIHJldHVybiAiQm9keSA6ICIgKyBzY2hlZHVsZS5ib2R5OwogICAgICAgIH0sCiAgICAgICAgcG9wdXBFZGl0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gIk1vZGlmaWVyIjsKICAgICAgICB9LAogICAgICAgIHBvcHVwRGVsZXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gIlN1cHByaW1lciI7CiAgICAgICAgfSwKICAgICAgfTsKICAgIH0sCiAgICBfZ2V0VGltZVRlbXBsYXRlKHNjaGVkdWxlLCBpc0FsbERheSkgewogICAgICB2YXIgaHRtbCA9IFtdOwoKICAgICAgaWYgKCFpc0FsbERheSkgewogICAgICAgIGh0bWwucHVzaCgKICAgICAgICAgICI8c3Ryb25nPiIgKwogICAgICAgICAgICBtb21lbnQoc2NoZWR1bGUuc3RhcnQudG9EYXRlKCkpLmZvcm1hdCgiSEg6bW0iKSArCiAgICAgICAgICAgICI8L3N0cm9uZz4gIgogICAgICAgICk7CiAgICAgIH0KICAgICAgaWYgKHNjaGVkdWxlLmlzUHJpdmF0ZSkgewogICAgICAgIGh0bWwucHVzaCgnPHNwYW4gY2xhc3M9ImNhbGVuZGFyLWZvbnQtaWNvbiBpYy1sb2NrLWIiPjwvc3Bhbj4nKTsKICAgICAgICBodG1sLnB1c2goIiBQcml2YXRlIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHNjaGVkdWxlLmlzUmVhZE9ubHkpIHsKICAgICAgICAgIGh0bWwucHVzaCgnPHNwYW4gY2xhc3M9ImNhbGVuZGFyLWZvbnQtaWNvbiBpYy1yZWFkb25seS1iIj48L3NwYW4+Jyk7CiAgICAgICAgfSBlbHNlIGlmIChzY2hlZHVsZS5yZWN1cnJlbmNlUnVsZSkgewogICAgICAgICAgaHRtbC5wdXNoKCc8c3BhbiBjbGFzcz0iY2FsZW5kYXItZm9udC1pY29uIGljLXJlcGVhdC1iIj48L3NwYW4+Jyk7CiAgICAgICAgfSBlbHNlIGlmIChzY2hlZHVsZS5hdHRlbmRlZXMubGVuZ3RoKSB7CiAgICAgICAgICBodG1sLnB1c2goJzxzcGFuIGNsYXNzPSJjYWxlbmRhci1mb250LWljb24gaWMtdXNlci1iIj48L3NwYW4+Jyk7CiAgICAgICAgfSBlbHNlIGlmIChzY2hlZHVsZS5sb2NhdGlvbikgewogICAgICAgICAgaHRtbC5wdXNoKCc8c3BhbiBjbGFzcz0iY2FsZW5kYXItZm9udC1pY29uIGljLWxvY2F0aW9uLWIiPjwvc3Bhbj4nKTsKICAgICAgICB9CgogICAgICAgIGh0bWwucHVzaCgiICIgKyBzY2hlZHVsZS50aXRsZSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBodG1sLmpvaW4oIiIpOwogICAgfSwKCiAgICBzZXRSZW5kZXJSYW5nZVRleHQoKSB7CiAgICAgIGxldCBvcHRpb25zID0gdGhpcy4kcmVmcy50dWlDYWxlbmRhci5pbnZva2UoImdldE9wdGlvbnMiKTsKICAgICAgbGV0IHZpZXdOYW1lID0gdGhpcy4kcmVmcy50dWlDYWxlbmRhci5pbnZva2UoImdldFZpZXdOYW1lIik7CiAgICAgIGxldCBodG1sID0gW107CiAgICAgIHRoaXMuc3RhcnREYXRlID0gdGhpcy4kcmVmcy50dWlDYWxlbmRhcgogICAgICAgIC5pbnZva2UoImdldERhdGVSYW5nZVN0YXJ0IikKICAgICAgICAudG9EYXRlKCkKICAgICAgICAudG9Mb2NhbGVEYXRlU3RyaW5nKCJmci1DQSIpOwogICAgICB0aGlzLmVuZERhdGUgPSB0aGlzLiRyZWZzLnR1aUNhbGVuZGFyCiAgICAgICAgLmludm9rZSgiZ2V0RGF0ZVJhbmdlRW5kIikKICAgICAgICAudG9EYXRlKCkKICAgICAgICAudG9Mb2NhbGVEYXRlU3RyaW5nKCJmci1DQSIpOwoKICAgICAgaWYgKHZpZXdOYW1lID09PSAiZGF5IikgewogICAgICAgIGh0bWwucHVzaCh0aGlzLmN1cnJlbnRDYWxlbmRhckRhdGUoIkREIE1NTU0gWVlZWSIpKTsKICAgICAgfSBlbHNlIGlmICgKICAgICAgICB2aWV3TmFtZSA9PT0gIm1vbnRoIiAmJgogICAgICAgICghb3B0aW9ucy5tb250aC52aXNpYmxlV2Vla3NDb3VudCB8fAogICAgICAgICAgb3B0aW9ucy5tb250aC52aXNpYmxlV2Vla3NDb3VudCA+IDQpCiAgICAgICkgewogICAgICAgIGh0bWwucHVzaCh0aGlzLmN1cnJlbnRDYWxlbmRhckRhdGUoIk1NTU0gWVlZWSIpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsZXQgdGltZSA9IG1vbWVudCgKICAgICAgICAgIHRoaXMuJHJlZnMudHVpQ2FsZW5kYXIuaW52b2tlKCJnZXREYXRlUmFuZ2VTdGFydCIpLmdldFRpbWUoKQogICAgICAgICk7CgogICAgICAgIGxldCBjdXJyZW50ZGF0ZSA9IG5ldyBEYXRlKHRpbWUpOwogICAgICAgIGxldCBvbmVKYW4gPSBuZXcgRGF0ZShjdXJyZW50ZGF0ZS5nZXRGdWxsWWVhcigpLCAwLCAxKTsKICAgICAgICBsZXQgbnVtYmVyT2ZEYXlzID0gTWF0aC5mbG9vcigKICAgICAgICAgIChjdXJyZW50ZGF0ZSAtIG9uZUphbikgLyAoMjQgKiA2MCAqIDYwICogMTAwMCkKICAgICAgICApOwogICAgICAgIGxldCByZXN1bHQgPSBNYXRoLmNlaWwoKGN1cnJlbnRkYXRlLmdldERheSgpICsgMSArIG51bWJlck9mRGF5cykgLyA3KTsKICAgICAgICBodG1sLnB1c2goCiAgICAgICAgICAiU2VtYWluZSAiICsKICAgICAgICAgICAgcmVzdWx0ICsKICAgICAgICAgICAgIiB8ICIgKwogICAgICAgICAgICBtb21lbnQodGhpcy4kcmVmcy50dWlDYWxlbmRhci5pbnZva2UoImdldERhdGVSYW5nZVN0YXJ0IikuZ2V0VGltZSgpKQogICAgICAgICAgICAgIC5sb2NhbGUodGhpcy5sb2NhbGUpCiAgICAgICAgICAgICAgLmZvcm1hdCgiREQgTU1NTSBZWVlZIikKICAgICAgICApOwogICAgICAgIGh0bWwucHVzaCgiIC0gIik7CiAgICAgICAgaHRtbC5wdXNoKAogICAgICAgICAgbW9tZW50KHRoaXMuJHJlZnMudHVpQ2FsZW5kYXIuaW52b2tlKCJnZXREYXRlUmFuZ2VFbmQiKS5nZXRUaW1lKCkpCiAgICAgICAgICAgIC5sb2NhbGUodGhpcy5sb2NhbGUpCiAgICAgICAgICAgIC5mb3JtYXQoIkREIE1NTU0gWVlZWSIpCiAgICAgICAgKTsKICAgICAgfQogICAgICB0aGlzLnJlbmRlclJhbmdlID0gaHRtbC5qb2luKCIiKTsKICAgIH0sCiAgICBnZW5lcmF0ZVF1ZXJ5Rm9yKGRhdGFBcnJheSwgZGF0YVBhcmFtLCByZXN1bHQpIHsKICAgICAgaWYgKGRhdGFBcnJheS5sZW5ndGggPiAwKSB7CiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmNvbmNhdCgKICAgICAgICAgIHJlc3VsdC5sZW5ndGggPT09IDAgPyAiY29uZGl0aW9uOiIgOiAiOnNlcGFyYXRvcjpBTkQ6Y29uZGl0aW9uOiIsCiAgICAgICAgICB0aGlzLnNldGZpbHRlcihkYXRhQXJyYXksIGRhdGFQYXJhbSkKICAgICAgICApOwogICAgICB9CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9LAogICAgZ2V0UXVlcnlQYXJhbShkYXRlRmlsdGVyID0gImRhdGVfYWN0aW9uIikgewogICAgICAvKioKICAgICAgICpAcGFyYW0gbm9uZQogICAgICAgKkBhdXRob3IgSmFjcXVlcwogICAgICAgKkBSZXN1bWUgOiBmaWd1cmUgb3V0ICBmaWx0ZXIgb24gQVBJIHJlcXVlc3QKICAgICAgICpAZXhhbXBsZSA6IGNvbmRpdGlvbjppZHV0aWxpc2F0ZXVyOmVnYWw6MTpPUjppZHV0aWxpc2F0ZXVyOmVnYWw6NDpzZXBhcmF0b3I6QU5EOmNvbmRpdGlvbjppZHByb2pldDplZ2FsOjE6T1I6aWRwcm9qZXQ6ZWdhbDo0MDYwOnNlcGFyYXRvcjpBTkQ6Y29uZGl0aW9uOmlkc29jaWV0ZTplZ2FsOjQ6T1I6aWRzb2NpZXRlOmVnYWw6MjIzNAogICAgICAgKiovCgogICAgICBsZXQgZmlsdGVyID0gIiI7CiAgICAgIC8vIGZpbHRlcmluZyB1c2VycwogICAgICBpZiAodGhpcy5zZWxlY3RlZFVzZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICBmaWx0ZXIgPSBmaWx0ZXIuY29uY2F0KAogICAgICAgICAgZmlsdGVyLmxlbmd0aCA9PT0gMCA/ICJjb25kaXRpb246IiA6ICI6c2VwYXJhdG9yOkFORDpjb25kaXRpb246IiwKICAgICAgICAgIHRoaXMuc2V0ZmlsdGVyKAogICAgICAgICAgICB0aGlzLnNlbGVjdGVkVXNlcnMubWFwKChlKSA9PiB7CiAgICAgICAgICAgICAgcmV0dXJuIGUuaWQ7CiAgICAgICAgICAgIH0pLAogICAgICAgICAgICAiaWR1dGlsaXNhdGV1ciIKICAgICAgICAgICkKICAgICAgICApOwogICAgICB9CgogICAgICAvLyBpZHByb2pldAogICAgICBpZiAodGhpcy5pZHByb2pldHMubGVuZ3RoID4gMCkgewogICAgICAgIGZpbHRlciA9IGZpbHRlci5jb25jYXQoCiAgICAgICAgICBmaWx0ZXIubGVuZ3RoID09PSAwID8gImNvbmRpdGlvbjoiIDogIjpzZXBhcmF0b3I6QU5EOmNvbmRpdGlvbjoiLAogICAgICAgICAgdGhpcy5zZXRmaWx0ZXIodGhpcy5pZHByb2pldHMsICJpZHByb2pldCIpCiAgICAgICAgKTsKICAgICAgfQoKICAgICAgLy8gaWRjb250YWN0CiAgICAgIGlmICh0aGlzLmlkY29udGFjdHMubGVuZ3RoID4gMCkgewogICAgICAgIGZpbHRlciA9IGZpbHRlci5jb25jYXQoCiAgICAgICAgICBmaWx0ZXIubGVuZ3RoID09PSAwID8gImNvbmRpdGlvbjoiIDogIjpzZXBhcmF0b3I6QU5EOmNvbmRpdGlvbjoiLAogICAgICAgICAgdGhpcy5zZXRmaWx0ZXIodGhpcy5pZGNvbnRhY3RzLCAiaWRjb250YWN0IikKICAgICAgICApOwogICAgICB9CgogICAgICAvLyBpZHNvY2lldGUKICAgICAgaWYgKHRoaXMuaWRzb2NpZXRlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgZmlsdGVyID0gZmlsdGVyLmNvbmNhdCgKICAgICAgICAgIGZpbHRlci5sZW5ndGggPT09IDAgPyAiY29uZGl0aW9uOiIgOiAiOnNlcGFyYXRvcjpBTkQ6Y29uZGl0aW9uOiIsCiAgICAgICAgICB0aGlzLnNldGZpbHRlcih0aGlzLmlkc29jaWV0ZXMsICJpZHNvY2lldGUiKQogICAgICAgICk7CiAgICAgIH0KCiAgICAgIC8vIFNldHRpbmcgY29uZGl0aW9uIG9uIERhdGVzCgogICAgICBmaWx0ZXIgPSBmaWx0ZXIuY29uY2F0KAogICAgICAgIGZpbHRlci5sZW5ndGggPT09IDAgPyAiY29uZGl0aW9uOiIgOiAiOnNlcGFyYXRvcjpBTkQ6Y29uZGl0aW9uOiIsCiAgICAgICAgZGF0ZUZpbHRlciArCiAgICAgICAgICAiOmJpZ2dlcnRoYW5vcmVnYWw6IiArCiAgICAgICAgICB0aGlzLnN0YXJ0RGF0ZSArCiAgICAgICAgICAiOkFORDoiICsKICAgICAgICAgIGRhdGVGaWx0ZXIgKwogICAgICAgICAgIjpsb3dlcnRoYW5vcmVnYWw6IiArCiAgICAgICAgICB0aGlzLmVuZERhdGUKICAgICAgKTsKCiAgICAgIHJldHVybiBmaWx0ZXI7CiAgICB9LAogICAgc2V0ZmlsdGVyKGxpc3RBcnJheSwgcGFyYW0pIHsKICAgICAgaWYgKGxpc3RBcnJheS5sZW5ndGggPT09IDEpIHsKICAgICAgICByZXR1cm4gcGFyYW0gKyAiOmVnYWw6IiArIGxpc3RBcnJheVswXTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgcGFyYW0gKwogICAgICAgICAgIjplZ2FsOiIgKwogICAgICAgICAgbGlzdEFycmF5WzBdICsKICAgICAgICAgICI6T1I6IiArCiAgICAgICAgICB0aGlzLnNldGZpbHRlcihsaXN0QXJyYXkuc2xpY2UoMSksIHBhcmFtKQogICAgICAgICk7CiAgICAgIH0KICAgIH0sCgogICAgYXN5bmMgZ2V0Q2FsZW5kYXJJdGVtKG5iUGFnZSA9IDAsIG9uRHVlRGF0ZSA9IGZhbHNlKSB7CiAgICAgIHJldHVybiBheGlvcyh7CiAgICAgICAgbWV0aG9kOiAiZ2V0IiwKICAgICAgICB1cmw6CiAgICAgICAgICB0aGlzLlVSSSArCiAgICAgICAgICB0aGlzLkFQSV9LRVkgKwogICAgICAgICAgIi8iICsKICAgICAgICAgIHRoaXMuZ2V0UXVlcnlQYXJhbShvbkR1ZURhdGUgPyAiZGF0ZV9lY2hlYW5jZSIgOiAiZGF0ZV9hY3Rpb24iKSArCiAgICAgICAgICAiLyIgKwogICAgICAgICAgbmJQYWdlLAogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgfSwKICAgICAgfSkudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5kYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGxldCByZXN1bHQgPSByZXNwb25zZS5kYXRhLmRhdGEubWFwKChlbGVtZW50KSA9PiB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgc3RhcnQ6IGVsZW1lbnQuZGF0ZV9hY3Rpb24udmFsdWUsCiAgICAgICAgICAgICAgZW5kOiBlbGVtZW50LmRhdGVfZmluLnZhbHVlLAogICAgICAgICAgICAgIGlzUmVhZE9ubHk6IGVsZW1lbnQuZV9sb2NrLnZhbHVlID09PSAiMSIsCiAgICAgICAgICAgICAgbG9jYXRpb246IGVsZW1lbnQubG9jYXRpb24udmFsdWUsCiAgICAgICAgICAgICAgaWRhY3Rpb246IGVsZW1lbnQuaWRhY3Rpb24udmFsdWUsCiAgICAgICAgICAgICAgdGl0bGU6IGVsZW1lbnQuc3VqZXQudmFsdWUsCiAgICAgICAgICAgICAgYmdDb2xvcjoKICAgICAgICAgICAgICAgIG9uRHVlRGF0ZSAmJiB0aGlzLnR5cGV2aWV3LmluZGV4ICE9ICJjb2xvcl9wcmlvcml0ZSIKICAgICAgICAgICAgICAgICAgPyAiI2YyYTY0MCIKICAgICAgICAgICAgICAgICAgOiB0aGlzLnNldENvbG9yKHRoaXMudHlwZXZpZXcsIGVsZW1lbnQpLAogICAgICAgICAgICAgIGNhdGVnb3J5OiAidGltZSIsCiAgICAgICAgICAgICAgZHVlRGF0ZUNsYXNzOiBlbGVtZW50LmRhdGVfZWNoZWFuY2UudmFsdWUsCiAgICAgICAgICAgICAgaWQ6IGVsZW1lbnQuaWRhY3Rpb24udmFsdWUudG9TdHJpbmcoKSwKICAgICAgICAgICAgICBjYWxlbmRhcklkOgogICAgICAgICAgICAgICAgdGhpcy5nZXRDYWxlbmRhcklkV2l0aENvbG9yKGVsZW1lbnQuY29sb3IudmFsdWUpIHx8ICIwIiwKICAgICAgICAgICAgfTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFsKICAgICAgICAgICAgLi4ucmVzdWx0LAogICAgICAgICAgICB0aGlzLmdldENhbGVuZGFySXRlbSgrK25iUGFnZSwgb25EdWVEYXRlKSwKICAgICAgICAgIF0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBhc3luYyBnZXRJdGVyYWN0aW9uc0hpc3RvcnkobmJQYWdlID0gMCkgewogICAgICByZXR1cm4gYXhpb3MoewogICAgICAgIG1ldGhvZDogImdldCIsCiAgICAgICAgdXJsOgogICAgICAgICAgdGhpcy5VUklfSElTVE9SWSArCiAgICAgICAgICB0aGlzLkFQSV9LRVkgKwogICAgICAgICAgIi8iICsKICAgICAgICAgIHRoaXMuZ2V0UXVlcnlQYXJhbSgpICsKICAgICAgICAgICIvIiArCiAgICAgICAgICBuYlBhZ2UsCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICB9LAogICAgICB9KS50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgIGlmIChyZXNwb25zZS5kYXRhLmRhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgLy9sZXQgaW5kZXggPSAwOwogICAgICAgICAgbGV0IHJlc3VsdCA9IHJlc3BvbnNlLmRhdGEuZGF0YS5tYXAoKGVsZW1lbnQpID0+IHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBzdGFydDogZWxlbWVudC5kYXRlX2FjdGlvbi52YWx1ZSwKICAgICAgICAgICAgICBlbmQ6IGVsZW1lbnQuZGF0ZV9maW4udmFsdWUsCiAgICAgICAgICAgICAgaXNSZWFkT25seTogZWxlbWVudC5lX2xvY2sudmFsdWUgPT09ICIxIiwKICAgICAgICAgICAgICBsb2NhdGlvbjogZWxlbWVudC5sb2NhdGlvbi52YWx1ZSwKICAgICAgICAgICAgICBpZGFjdGlvbjogZWxlbWVudC5pZGFjdGlvbi52YWx1ZSwKICAgICAgICAgICAgICAvLyAgIHN0YXRlOiBlbGVtZW50LmV0YXQudmFsdWUgPT09IDAgPyAiQnVzeSIgOiAiRnJlZSIsCiAgICAgICAgICAgICAgdGl0bGU6IGVsZW1lbnQuc3VqZXQudmFsdWUsCiAgICAgICAgICAgICAgYmdDb2xvcjogIiM4Y2JmNDAiLCAvLyB0aGlzLnNldENvbG9yKHRoaXMudHlwZXZpZXcsIGVsZW1lbnQpLAogICAgICAgICAgICAgIGNhdGVnb3J5OiAidGltZSIsCiAgICAgICAgICAgICAgLy8gY29sb3I6IHRoaXMuc2V0Q29sb3IodGhpcy50eXBldmlldywgZWxlbWVudCksCiAgICAgICAgICAgICAgZHVlRGF0ZUNsYXNzOiBlbGVtZW50LmRhdGVfZWNoZWFuY2UudmFsdWUsCiAgICAgICAgICAgICAgaWQ6IGVsZW1lbnQuaWRhY3Rpb24udmFsdWUudG9TdHJpbmcoKSwKICAgICAgICAgICAgICBjYWxlbmRhcklkOgogICAgICAgICAgICAgICAgdGhpcy5nZXRDYWxlbmRhcklkV2l0aENvbG9yKGVsZW1lbnQuY29sb3IudmFsdWUpIHx8ICIwIiwKICAgICAgICAgICAgfTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFsuLi5yZXN1bHQsIHRoaXMuZ2V0SXRlcmFjdGlvbnNIaXN0b3J5KCsrbmJQYWdlKV0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBjdXJyZW50Q2FsZW5kYXJEYXRlKGZvcm1hdCkgewogICAgICB2YXIgY3VycmVudERhdGUgPSBtb21lbnQoWwogICAgICAgIHRoaXMuJHJlZnMudHVpQ2FsZW5kYXIuaW52b2tlKCJnZXREYXRlIikuZ2V0RnVsbFllYXIoKSwKICAgICAgICB0aGlzLiRyZWZzLnR1aUNhbGVuZGFyLmludm9rZSgiZ2V0RGF0ZSIpLmdldE1vbnRoKCksCiAgICAgICAgdGhpcy4kcmVmcy50dWlDYWxlbmRhci5pbnZva2UoImdldERhdGUiKS5nZXREYXRlKCksCiAgICAgIF0pOwoKICAgICAgLy8gZmlyc3QgbGV0dGVyIHVwcGVyY2FzZQogICAgICByZXR1cm4gKAogICAgICAgIGN1cnJlbnREYXRlLmxvY2FsZSh0aGlzLmxvY2FsZSkuZm9ybWF0KGZvcm1hdCkuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKwogICAgICAgIGN1cnJlbnREYXRlLmxvY2FsZSh0aGlzLmxvY2FsZSkuZm9ybWF0KGZvcm1hdCkuc2xpY2UoMSkKICAgICAgKTsKICAgIH0sCiAgICBnZXRDYWxlbmRhcldpdGhDb2xvcihjb2xvcikgewogICAgICAvLyBnZXQgaW5kZXgKICAgICAgbGV0IGluZGV4ID0gdGhpcy5jYWxlbmRhckxpc3QuZmluZEluZGV4KAogICAgICAgIChlbGVtZW50KSA9PiBlbGVtZW50LmJnQ29sb3IgPT09IGNvbG9yCiAgICAgICk7CiAgICAgIC8vIHJldHVybiBjYWxlbmRhcgogICAgICByZXR1cm4gdGhpcy5jYWxlbmRhckxpc3RbaW5kZXhdPy5iZ0NvbG9yIHx8ICIjRkZGIjsKICAgIH0sCiAgICBnZXRDYWxlbmRhcklkV2l0aENvbG9yKGNvbG9yKSB7CiAgICAgIC8vIGdldCBpbmRleAogICAgICBsZXQgaW5kZXggPSB0aGlzLmNhbGVuZGFyTGlzdC5maW5kSW5kZXgoCiAgICAgICAgKGVsZW1lbnQpID0+IGVsZW1lbnQuYmdDb2xvciA9PT0gY29sb3IKICAgICAgKTsKICAgICAgLy8gcmV0dXJuIGNhbGVuZGFyCiAgICAgIHJldHVybiB0aGlzLmNhbGVuZGFyTGlzdFtpbmRleF0/LmlkOwogICAgfSwKICAgIGdldFRvZGF5KCkgewogICAgICB0aGlzLiRyZWZzLnR1aUNhbGVuZGFyLmludm9rZSgidG9kYXkiKTsKICAgICAgdGhpcy5zZXRSZW5kZXJSYW5nZVRleHQoKTsKICAgICAgdGhpcy5kaXNwYXRjaEFjdGlvbigpOwogICAgfSwKICAgIG5leHQoKSB7CiAgICAgIHRoaXMuJHJlZnMudHVpQ2FsZW5kYXIuaW52b2tlKCJuZXh0Iik7CiAgICAgIHRoaXMuc2V0UmVuZGVyUmFuZ2VUZXh0KCk7CiAgICAgIHRoaXMuZGlzcGF0Y2hBY3Rpb24oKTsKICAgIH0sCiAgICBwcmV2KCkgewogICAgICB0aGlzLiRyZWZzLnR1aUNhbGVuZGFyLmludm9rZSgicHJldiIpOwogICAgICB0aGlzLnNldFJlbmRlclJhbmdlVGV4dCgpOwogICAgICB0aGlzLmRpc3BhdGNoQWN0aW9uKCk7CiAgICB9LAogICAgdG9kYXkoKSB7CiAgICAgIHRoaXMuJHJlZnMudHVpQ2FsZW5kYXIuaW52b2tlKCJ0b2RheSIpOwogICAgICB0aGlzLnNldFJlbmRlclJhbmdlVGV4dCgpOwogICAgICB0aGlzLmRpc3BhdGNoQWN0aW9uKCk7CiAgICB9LAogICAgY2hhbmdlVmlldyh2aWV3TmFtZSkgewogICAgICB0aGlzLiRyZWZzLnR1aUNhbGVuZGFyLmludm9rZSgiY2hhbmdlVmlldyIsIHZpZXdOYW1lKTsKICAgIH0sCiAgICBvbkNsaWNrU2NoZWR1bGUocmVzKSB7CiAgICAgIHRoaXMuc2VsZWN0ZWQgPSByZXM7CgogICAgICAvLyBzZXQgbW9yZSBjYXJkIHRvIGRpc3BsYXkgbm9uZQogICAgICBsZXQgY2FyZCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoCiAgICAgICAgInR1aS1mdWxsLWNhbGVuZGFyLW1vbnRoLW1vcmUiCiAgICAgICk7CiAgICAgIGNhcmRbMF0uc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgIH0sCiAgICBvbkNsaWNrRGF5bmFtZShyZXMpIHsKICAgICAgLy8gdmlldyA6IHdlZWssIGRheQogICAgICBjb25zb2xlLmdyb3VwKCJvbkNsaWNrRGF5bmFtZSIpOwogICAgICBjb25zb2xlLmxvZyhyZXMuZGF0ZSk7CiAgICAgIGNvbnNvbGUuZ3JvdXBFbmQoKTsKICAgIH0sCgogICAgb25CZWZvcmVDcmVhdGVTY2hlZHVsZShlKSB7CiAgICAgIHRoaXMuZXZlbnQgPSBlOwogICAgICBjb25zdCBldmVudERhdGUgPSBlLnN0YXJ0LnRvRGF0ZSgpOwogICAgICB0aGlzLmRhdGVDcmVhdGVFdmVudCA9CiAgICAgICAgZXZlbnREYXRlLnRvTG9jYWxlRGF0ZVN0cmluZygiZnItQ0EiKSArCiAgICAgICAgIl8iICsKICAgICAgICAoZXZlbnREYXRlLmdldEhvdXJzKCkgPCAxMCA/ICIwIiA6ICIiKSArCiAgICAgICAgZXZlbnREYXRlLmdldEhvdXJzKCkgKwogICAgICAgICItIiArCiAgICAgICAgKGV2ZW50RGF0ZS5nZXRNaW51dGVzKCkgPCAxMCA/ICIwIiA6ICIiKSArCiAgICAgICAgZXZlbnREYXRlLmdldE1pbnV0ZXMoKTsKICAgICAgZS5ndWlkZS5jbGVhckd1aWRlRWxlbWVudCgpOwogICAgICB0aGlzLmNsaWNrQ291bnQgPSB0aGlzLmNsaWNrQ291bnQgPT09IDAgPyAxIDogMDsKICAgICAgdGhpcy5jcmVhdGluZyA9IHRoaXMuY2xpY2tDb3VudCA9PT0gMDsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgdGhpcy5vcGVuSWZyYW1lRWRpdG9yKCk7CiAgICAgIH0sIDUwKTsKICAgIH0sCiAgICBvbkJlZm9yZVVwZGF0ZVNjaGVkdWxlKGUpIHsKICAgICAgdmFyIGVtID0gdGhpczsKCiAgICAgIGxldCBzY2hlZHVsZSA9IHRoaXMuQ3NjaGVkdWxlTGlzdC5maW5kKAogICAgICAgIChlbGVtZW50KSA9PiBlbGVtZW50LmlkID09PSBlLnNjaGVkdWxlLmlkCiAgICAgICk7CgogICAgICBlLnNjaGVkdWxlLnN0YXJ0ID0gZS5zdGFydDsKICAgICAgZS5zY2hlZHVsZS5lbmQgPSBlLmVuZDsKICAgICAgc2NoZWR1bGUuY2FsZW5kYXJJZCA9IGUuY2hhbmdlcy5jYWxlbmRhcklkIHx8IGUuc2NoZWR1bGUuY2FsZW5kYXJJZDsKICAgICAgc2NoZWR1bGUudGl0bGUgPSBlLmNoYW5nZXMudGl0bGUgfHwgZS5zY2hlZHVsZS50aXRsZTsKICAgICAgc2NoZWR1bGUuY2F0ZWdvcnkgPSBlLmNoYW5nZXMuaXNBbGxEYXkKICAgICAgICA/ICJhbGxkYXkiCiAgICAgICAgOiAidGltZSIgfHwgZS5jaGFuZ2VzLmNhdGVnb3J5OwoKICAgICAgc2NoZWR1bGUuc3RhcnQgPSBlLnN0YXJ0OwogICAgICBzY2hlZHVsZS5lbmQgPSBlLmVuZDsKICAgICAgc2NoZWR1bGUuaXNSZWFkT25seSA9IGUuY2hhbmdlcy5pc1ByaXZhdGUgfHwgZS5jaGFuZ2VzLmlzUmVhZE9ubHk7CiAgICAgIHNjaGVkdWxlLmxvY2F0aW9uID0gZS5jaGFuZ2VzLmxvY2F0aW9uIHx8IGUuc2NoZWR1bGUubG9jYXRpb247CiAgICAgIHNjaGVkdWxlLmJnQ29sb3IgPQogICAgICAgIHRoaXMuY2FsZW5kYXJMaXN0WwogICAgICAgICAgZS5jaGFuZ2VzLmNhbGVuZGFySWQgfHwgZS5zY2hlZHVsZS5jYWxlbmRhcklkCiAgICAgICAgXS5iZ0NvbG9yOwoKICAgICAgdmFyIHQgPSBuZXcgRGF0ZShlLnNjaGVkdWxlLnN0YXJ0KS50b0lTT1N0cmluZygpOwogICAgICB0ID0gU3RyaW5nKHQpLnJlcGxhY2UoIlQiLCAiICIpOwogICAgICB0ID0gU3RyaW5nKHQpLnJlcGxhY2UoIi4wMDBaIiwgIiIpOwoKICAgICAgY29uc3QgdGltZV9kaWZmZXJlbmNlID0gZS5lbmQuZ2V0VGltZSgpIC0gZS5zdGFydC5nZXRUaW1lKCk7CiAgICAgIC8vY2FsY3VsYXRlIGRheXMgZGlmZmVyZW5jZSBieSBkaXZpZGluZyB0b3RhbCBtaWxsaXNlY29uZHMgaW4gYSBkYXkKICAgICAgY29uc3QgaG91cnMgPSBNYXRoLmZsb29yKHRpbWVfZGlmZmVyZW5jZSAvICgxMDAwICogNjAgKiA2MCkpOwogICAgICBjb25zdCByZW1haW5pbmdfbWlsbGlzZWNvbmRzID0gdGltZV9kaWZmZXJlbmNlICUgKDEwMDAgKiA2MCAqIDYwKTsKICAgICAgY29uc3QgbWludXRlcyA9IE1hdGguZmxvb3IocmVtYWluaW5nX21pbGxpc2Vjb25kcyAvICgxMDAwICogNjApKTsKCiAgICAgIHZhciBjb25maWcgPSB7CiAgICAgICAgbWV0aG9kOiAicHV0IiwKICAgICAgICB1cmw6IHRoaXMuVVJJX0FDVElPTiArIHRoaXMuQVBJX0tFWSwKCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICB9LAogICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgIGlkYWN0aW9uOiBzY2hlZHVsZS5pZGFjdGlvbiwKICAgICAgICAgIHN1amV0OiBzY2hlZHVsZS50aXRsZSwKICAgICAgICAgIGFsbF9kYXk6IHNjaGVkdWxlLmNhdGVnb3J5ID09ICJhbGxkYXkiID8gMSA6IDAsCiAgICAgICAgICBkYXRlX2FjdGlvbjogdCwKICAgICAgICAgIGR1cmVlX2hldXJlczogaG91cnMsCiAgICAgICAgICBkdXJlZV9taW51dGVzOiBtaW51dGVzLAogICAgICAgICAgbG9jYXRpb246IHNjaGVkdWxlLmxvY2F0aW9uLAogICAgICAgICAgLy8gICAgZXRhdDogc2NoZWR1bGUuc3RhdGUgPT0gIkJ1c3kiID8gMSA6IDAsCiAgICAgICAgICBjb2xvcjogc2NoZWR1bGUuYmdDb2xvciwKICAgICAgICAgIGVfbG9jazogc2NoZWR1bGUuaXNSZWFkT25seSA/IDEgOiAwLAogICAgICAgIH0pLAogICAgICB9OwoKICAgICAgYXhpb3MoY29uZmlnKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICBlbS5Dc2NoZWR1bGVMaXN0ID0gZW0uQ3NjaGVkdWxlTGlzdC5tYXAoKGVsZW1lbnQpID0+CiAgICAgICAgICBlbGVtZW50LmlkICE9PSBlLnNjaGVkdWxlLmlkCiAgICAgICAgICAgID8gZWxlbWVudAogICAgICAgICAgICA6IHsKICAgICAgICAgICAgICAgIC4uLmVsZW1lbnQsCiAgICAgICAgICAgICAgICAuLi5zY2hlZHVsZSwKICAgICAgICAgICAgICB9CiAgICAgICAgKTsKCiAgICAgICAgZW0uJHJlZnMudHVpQ2FsZW5kYXIuaW52b2tlKCJ1cGRhdGVTY2hlZHVsZSIsIGUuc2NoZWR1bGUuaWQsIHNjaGVkdWxlKTsKICAgICAgfSk7CiAgICB9LAoKICAgIG9uQmVmb3JlRGVsZXRlU2NoZWR1bGUoZSkgewogICAgICB0aGlzLnNlbGVjdGVkID0gbnVsbDsKCiAgICAgIHZhciBpZGFjdGlvbiA9IHRoaXMuQ3NjaGVkdWxlTGlzdC5maW5kKChlbGVtZW50KSA9PiB7CiAgICAgICAgcmV0dXJuIGVsZW1lbnQuaWQgPT09IGUuc2NoZWR1bGUuaWQ7CiAgICAgIH0pPy5pZGFjdGlvbjsKCiAgICAgIHZhciBjb25maWcgPSB7CiAgICAgICAgbWV0aG9kOiAiZGVsZXRlIiwKICAgICAgICB1cmw6IHRoaXMuVVJJX0FDVElPTiArIHRoaXMuQVBJX0tFWSArICIvIiArIGlkYWN0aW9uLAogICAgICAgIGhlYWRlcnM6IHt9LAogICAgICB9OwoKICAgICAgYXhpb3MoY29uZmlnKS50aGVuKCgpID0+IHsKICAgICAgICAvLyByZW1vdmUgaW4gc2NoZWR1bGVMaXN0CiAgICAgICAgdGhpcy5Dc2NoZWR1bGVMaXN0ID0gdGhpcy5Dc2NoZWR1bGVMaXN0LmZpbHRlcigKICAgICAgICAgIChlbGVtZW50KSA9PiBlbGVtZW50LmlkICE9PSBlLnNjaGVkdWxlLmlkCiAgICAgICAgKTsKICAgICAgICB0aGlzLiRyZWZzLnR1aUNhbGVuZGFyLmludm9rZSgKICAgICAgICAgICJkZWxldGVTY2hlZHVsZSIsCiAgICAgICAgICBlLnNjaGVkdWxlLmlkLAogICAgICAgICAgZS5zY2hlZHVsZS5jYWxlbmRhcklkCiAgICAgICAgKTsKICAgICAgfSk7CiAgICB9LAogICAgLy9TdXBwcmVzc2lvbiBkZXMgdGFjaGVzCiAgICBvbkNsaWNrVGltZXpvbmVzQ29sbGFwc2VCdG4odGltZXpvbmVzQ29sbGFwc2VkKSB7CiAgICAgIC8vIHZpZXcgOiB3ZWVrLCBkYXkKICAgICAgaWYgKHRpbWV6b25lc0NvbGxhcHNlZCkgewogICAgICAgIHRoaXMudGhlbWVbIndlZWsudGltZWdyaWRMZWZ0LndpZHRoIl0gPSAiMTAwcHgiOwogICAgICAgIHRoaXMudGhlbWVbIndlZWsuZGF5Z3JpZExlZnQud2lkdGgiXSA9ICIxMDBweCI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy50aGVtZVsid2Vlay50aW1lZ3JpZExlZnQud2lkdGgiXSA9ICI1MHB4IjsKICAgICAgICB0aGlzLnRoZW1lWyJ3ZWVrLmRheWdyaWRMZWZ0LndpZHRoIl0gPSAiNTBweCI7CiAgICAgIH0KICAgIH0sCiAgICBnZXRDYWxlbmRhcihjYWxlbmRhcklkKSB7CiAgICAgIHJldHVybiB0aGlzLmNhbGVuZGFyTGlzdC5maW5kKChjYWxlbmRhcikgPT4gY2FsZW5kYXIuaWQgPT09IGNhbGVuZGFySWQpOwogICAgfSwKICAgIG9wZW5JZnJhbWVFZGl0b3IoKSB7CiAgICAgIC8vIGNyZWF0ZSBkaXYgY2FyZCBieSBnZXRlbGVtZW50YnlpZAogICAgICBsZXQgY2FyZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmbG9hdGluZy1sYXllci1jb250YWluZXIiKTsKCiAgICAgIC8vIHNldCAyLzMgd2lkdGggb2Ygc2NyZWVuIHRvIGNhcmQgb25seSBvbiBkZXNrdG9wCiAgICAgIGlmIChjYXJkICE9IG51bGwpIHsKICAgICAgICBpZiAod2luZG93LmlubmVyV2lkdGggPiA3NjgpIHsKICAgICAgICAgIGNhcmQuc3R5bGUud2lkdGggPSAiY2FsYygxMDAlIC0gMjUwcHgpIjsKICAgICAgICAgIGNhcmQuc3R5bGUuaGVpZ2h0ID0gImNhbGMoMTAwJSAtIDI1MHB4KSI7CiAgICAgICAgICBjYXJkLnN0eWxlLmxlZnQgPSAiY2FsYyg1MCUgLSAoY2FsYygxMDAlIC0gMjUwcHgpIC8gMikpIjsKICAgICAgICAgIGNhcmQuc3R5bGUudG9wID0gImNhbGMoNTAlIC0gKGNhbGMoMTAwJSAtIDI1MHB4KSAvIDIpKSI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNhcmQuc3R5bGUud2lkdGggPSAiY2FsYygxMDAlIC0gMTUwcHgpIjsKICAgICAgICAgIGNhcmQuc3R5bGUubGVmdCA9ICJjYWxjKDUwJSAtIChjYWxjKDEwMCUgLSAxNTBweCkgLyAyKSkiOwogICAgICAgICAgY2FyZC5zdHlsZS50b3AgPSAiY2FsYyg1MCUgLSAoY2FsYygxMDAlIC0gODAwcHgpIC8gMikpIjsKICAgICAgICAgIGNhcmQuc3R5bGUuaGVpZ2h0ID0gImNhbGMoMTAwJSAtIDE1MHB4KSI7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgY2hlY2tpbmdGcmFtZShlKSB7CiAgICAgIGNvbnNvbGUubG9nKCJtZXNzYWdlIik7CiAgICAgIGNvbnNvbGUubG9nKGUpOwogICAgICBjb25zb2xlLmxvZyh0aGlzLiRyZWZzLmVkaXRkYXRhKTsKICAgIH0sCiAgICBlZGl0KCkgewogICAgICB0aGlzLmVkaXRpbmcgPSB0cnVlOwogICAgICB0aGlzLm9wZW5JZnJhbWVFZGl0b3IoKTsKICAgIH0sCiAgICBpZnJhbWVMb2FkZWQoKSB7CiAgICAgIC8vIGdldCBpZnJhbWUgZG9jdW1lbnQKICAgICAgbGV0IGlmcmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0dWktZnVsbC1jYWxlbmRhci1wb3B1cC1pZnJhbWUiKTsKCiAgICAgIC8vIGNoZWNrIHVybAogICAgICBpZiAoCiAgICAgICAgaWZyYW1lICYmCiAgICAgICAgaWZyYW1lLmNvbnRlbnRXaW5kb3cubG9jYXRpb24uaHJlZi5pbmNsdWRlcygiL2FjdGlvbi5waHAiKQogICAgICApIHsKICAgICAgICB0aGlzLmVkaXRpbmcgPSBmYWxzZTsKICAgICAgICB0aGlzLmNyZWF0aW5nID0gZmFsc2U7CiAgICAgICAgdGhpcy5zZWxlY3RlZCA9IG51bGw7CiAgICAgIH0KICAgIH0sCiAgfSwKICB3YXRjaDogewogICAgdmlldyh2YWx1ZSkgewogICAgICB0aGlzLmNoYW5nZVZpZXcodmFsdWUpOwogICAgICB0aGlzLnNldFJlbmRlclJhbmdlVGV4dCgpOwogICAgfSwKICAgIHNlbGVjdGVkKGNvbnRlbnQpIHsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgdGhpcy5lZGl0aW5nID0gZmFsc2U7CiAgICAgICAgbGV0IGV2ZW50ID0gbnVsbDsKICAgICAgICBpZiAoY29udGVudCAmJiBjb250ZW50LmV2ZW50KSB7CiAgICAgICAgICBldmVudCA9IGNvbnRlbnQuZXZlbnQ7CiAgICAgICAgICAvLyBnZXQgcG9zaXRpb24gZnJvbSBldmVudAogICAgICAgICAgY29uc3QgcG9zaXRpb24gPSB7CiAgICAgICAgICAgIHRvcDogZXZlbnQucGFnZVkgLSBldmVudC50YXJnZXQub2Zmc2V0VG9wLAogICAgICAgICAgICBsZWZ0OiBldmVudC5wYWdlWCAtIGV2ZW50LnRhcmdldC5vZmZzZXRMZWZ0LAogICAgICAgICAgfTsKCiAgICAgICAgICAvLyBnZXQgZGl2IGNhcmQgYnkgZ2V0ZWxlbWVudGJ5aWQKICAgICAgICAgIGxldCBjYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImZsb2F0aW5nLWxheWVyLWNvbnRhaW5lciIpOwoKICAgICAgICAgIC8vIHNldCBwb3NpdGlvbiBmcm9tIGV2ZW50IG1vdXNlIHRvIGNhcmQKICAgICAgICAgIGlmIChjYXJkKSB7CiAgICAgICAgICAgIGNhcmQuc3R5bGUudG9wID0gYGNhbGMoJHtwb3NpdGlvbi50b3B9cHggLSA4MHB4KWA7CiAgICAgICAgICAgIGNhcmQuc3R5bGUubGVmdCA9IGBjYWxjKCR7cG9zaXRpb24ubGVmdH1weCArIDI1cHgpYDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIDEwMCk7CiAgICB9LAogIH0sCiAgYXN5bmMgbW91bnRlZCgpIHsKICAgIHRoaXMuZ2V0VGVtcGxhdGUoKTsKICAgIGF3YWl0IHRoaXMubG9hZFVzZXJzKCk7IC8vIGxvYWRpbmcgdXNlcnMgbGlzdCoKICAgIHRoaXMuc2V0UmVuZGVyUmFuZ2VUZXh0KCk7CiAgICB0aGlzLmRpc3BhdGNoQWN0aW9uKCk7IC8vIExvYWQgYW5kIHNldCBjYWxlbmRhdCBpdGVtOwoKICAgIC8vIGNsaWNrIG91dHNsaWRlIHRvIGNsb3NlIGNhcmQKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKGUpID0+IHsKICAgICAgLy8gaWYgY2xpY2sgb3V0c2xpZGUKICAgICAgaWYgKAogICAgICAgIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY2FsZW5kYXIiKS5jb250YWlucyhlLnRhcmdldCkgPT09IGZhbHNlICYmCiAgICAgICAgICAhdGhpcy5lZGl0aW5nKSB8fAogICAgICAgIChlLnRhcmdldC5jbGFzc05hbWUgIT09ICJ0dWktZnVsbC1jYWxlbmRhci13ZWVrZGF5LXNjaGVkdWxlIiAmJgogICAgICAgICAgZS50YXJnZXQuY2xhc3NOYW1lICE9PSAidHVpLWZ1bGwtY2FsZW5kYXItd2Vla2RheS1zY2hlZHVsZS10aXRsZSIgJiYKICAgICAgICAgIGUudGFyZ2V0LmNsYXNzTmFtZS5pbmNsdWRlcygidHVpLWZ1bGwtY2FsZW5kYXItd2Vla2RheS1ncmlkLWxpbmUiKSAmJgogICAgICAgICAgZS50YXJnZXQuY2xhc3NOYW1lID09PQogICAgICAgICAgICAidHVpLWZ1bGwtY2FsZW5kYXItd2Vla2RheS1zY2hlZHVsZS1jb250ZW50IikgfHwKICAgICAgICBlLnRhcmdldC5jbGFzc05hbWUuaW5jbHVkZXMoCiAgICAgICAgICAidHVpLWZ1bGwtY2FsZW5kYXItdGltZS1kYXRlLXNjaGVkdWxlLWJsb2NrLXdyYXAiCiAgICAgICAgKSB8fAogICAgICAgICgoZS50YXJnZXQuY2xhc3NOYW1lLmluY2x1ZGVzKCJ0dWktZnVsbC1jYWxlbmRhci13ZWVrZGF5LXNjaGVkdWxlIikgfHwKICAgICAgICAgIGUudGFyZ2V0LmNsYXNzTmFtZS5pbmNsdWRlcygKICAgICAgICAgICAgInR1aS1mdWxsLWNhbGVuZGFyLXdlZWtkYXktc2NoZWR1bGUtY29udGVudCIKICAgICAgICAgICkgfHwKICAgICAgICAgIGUudGFyZ2V0LmNsYXNzTmFtZS5pbmNsdWRlcygidHVpLWZ1bGwtY2FsZW5kYXItd2Vla2RheS1ncmlkLWxpbmUiKSB8fAogICAgICAgICAgZS50YXJnZXQuY2xhc3NOYW1lLmluY2x1ZGVzKAogICAgICAgICAgICAidHVpLWZ1bGwtY2FsZW5kYXItdGltZS1kYXRlLXNjaGVkdWxlLWJsb2NrLXdyYXAiCiAgICAgICAgICApKSAmJgogICAgICAgICAgdGhpcy5lZGl0aW5nKSB8fAogICAgICAgICgoZS50YXJnZXQuY2xhc3NOYW1lLmluY2x1ZGVzKCJ0dWktZnVsbC1jYWxlbmRhci13ZWVrZGF5LWdyaWQtbGluZSIpIHx8CiAgICAgICAgICBlLnRhcmdldC5jbGFzc05hbWUuaW5jbHVkZXMoCiAgICAgICAgICAgICJ0dWktZnVsbC1jYWxlbmRhci10aW1lLWRhdGUtc2NoZWR1bGUtYmxvY2std3JhcCIKICAgICAgICAgICkpICYmCiAgICAgICAgICB0aGlzLmVkaXRpbmcgJiYKICAgICAgICAgIHRoaXMuY3JlYXRpbmcpCiAgICAgICkgewogICAgICAgIHRoaXMuZWRpdGluZyA9IGZhbHNlOwogICAgICAgIHRoaXMuY3JlYXRpbmcgPSBmYWxzZTsKICAgICAgICB0aGlzLnNlbGVjdGVkID0gbnVsbDsKICAgICAgICBpZiAodGhpcy5jbGlja0NvdW50ID09PSAxKSB0aGlzLmNsaWNrQ291bnQgPT09IDI7CiAgICAgICAgaWYgKHRoaXMuY2xpY2tDb3VudCA9PT0gMikgdGhpcy5jbGlja0NvdW50ID09PSAwOwogICAgICB9IGVsc2UgaWYgKAogICAgICAgIHRoaXMuc2VsZWN0ZWQgIT09IG51bGwgJiYKICAgICAgICBlLnRhcmdldC5jbGFzc05hbWUgIT09ICJ0dWktZnVsbC1jYWxlbmRhci13ZWVrZGF5LXNjaGVkdWxlLXRpdGxlIiAmJgogICAgICAgIGUudGFyZ2V0LmNsYXNzTmFtZSAhPT0KICAgICAgICAgICJ0dWktZnVsbC1jYWxlbmRhci10aW1lLXNjaGVkdWxlLWNvbnRlbnQgdHVpLWZ1bGwtY2FsZW5kYXItdGltZS1zY2hlZHVsZS1jb250ZW50LXRpbWUiICYmCiAgICAgICAgIXRoaXMuZWRpdGluZwogICAgICApIHsKICAgICAgICB0aGlzLnNlbGVjdGVkID0gbnVsbDsKICAgICAgICBpZiAodGhpcy5jbGlja0NvdW50ID09PSAxKSB0aGlzLmNsaWNrQ291bnQgPT09IDI7CiAgICAgICAgaWYgKHRoaXMuY2xpY2tDb3VudCA9PT0gMikgdGhpcy5jbGlja0NvdW50ID09PSAwOwogICAgICB9IGVsc2UgaWYgKAogICAgICAgIGUudGFyZ2V0LmNsYXNzTmFtZSA9PT0gInR1aS1mdWxsLWNhbGVuZGFyLXdlZWtkYXktc2NoZWR1bGUtdGl0bGUiIHx8CiAgICAgICAgZS50YXJnZXQuY2xhc3NOYW1lID09PQogICAgICAgICAgInR1aS1mdWxsLWNhbGVuZGFyLXRpbWUtc2NoZWR1bGUtY29udGVudCB0dWktZnVsbC1jYWxlbmRhci10aW1lLXNjaGVkdWxlLWNvbnRlbnQtdGltZSIKICAgICAgKSB7CiAgICAgICAgdGhpcy5jcmVhdGluZyA9IGZhbHNlOwogICAgICAgIGlmICh0aGlzLmNsaWNrQ291bnQgPT09IDEpIHRoaXMuY2xpY2tDb3VudCA9PT0gMjsKICAgICAgICBpZiAodGhpcy5jbGlja0NvdW50ID09PSAyKSB0aGlzLmNsaWNrQ291bnQgPT09IDA7CiAgICAgIH0KICAgIH0pOwogIH0sCn07Cg=="},{"version":3,"sources":["agenda.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuWA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"agenda.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"columns is-multiline is-mobile\">\n    <b-loading\n      :is-full-page=\"isFullPage\"\n      v-model=\"isLoading\"\n      :can-cancel=\"true\"\n    ></b-loading>\n    <div class=\"column is-12\">\n      <div\n        class=\"is-flex-widescreen is-flex-wrap-wrap is-justify-content-space-between is-align-items-center px-6 py-2 has-text-left\"\n      >\n        <div class=\"is-flex-widescreen is-align-items-center\">\n          <div\n            class=\"is-flex-tablet is-flex-wrap-wrap is-align-items-center mr-2 mb-2\"\n          >\n            <label class=\"label pt-2\">\n              Affichage <span class=\"is-hidden-widescreen\">&nbsp;&nbsp;</span> :\n              &nbsp;\n            </label>\n            <div class=\"control is-flex-grow-2\">\n              <div\n                class=\"dropdown is-block is-fullwidth\"\n                v-bind:class=\"showing\"\n              >\n                <div class=\"dropdown-trigger\">\n                  <button\n                    class=\"button is-fullwidth is-justify-content-space-between\"\n                    aria-haspopup=\"true\"\n                    aria-controls=\"dropdown-menu\"\n                    @click=\"show\"\n                  >\n                    <span class=\"icon-text\">\n                      <span class=\"icon\">\n                        <i\n                          class=\"fas fa-circle\"\n                          v-bind:style=\"{ color: typeview.color }\"\n                        ></i>\n                      </span>\n                      <span>{{ typeview.title }}</span>\n                    </span>\n                    <span class=\"icon is-small\">\n                      <i class=\"fas fa-angle-down\" aria-hidden=\"true\"></i>\n                    </span>\n                  </button>\n                </div>\n                <div class=\"dropdown-menu\" id=\"dropdown-menu\" role=\"menu\">\n                  <div class=\"dropdown-content\">\n                    <a\n                      class=\"dropdown-item\"\n                      v-for=\"(item, i) in arrayFilter\"\n                      :key=\"i\"\n                      :value=\"item.title\"\n                      @click=\"setView(item)\"\n                    >\n                      <span class=\"icon-text\">\n                        <span class=\"icon\" v-bind:style=\"{ color: item.color }\">\n                          <i class=\"fas fa-circle\"></i>\n                        </span>\n                        <span>{{ item.title }}</span>\n                      </span>\n                    </a>\n                    <hr class=\"dropdown-divider\" />\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div\n            class=\"is-flex-tablet is-flex-wrap-wrap is-align-items-center mr-2 mb-2\"\n          >\n            <label class=\"label pt-2\">Utilisateurs : &nbsp;</label>\n            <div class=\"control is-flex-grow-2\">\n              <div class=\"select is-block\">\n                <multiselect\n                  v-model=\"selectedUsers\"\n                  :options=\"users\"\n                  :multiple=\"true\"\n                  :close-on-select=\"false\"\n                  :clear-on-select=\"false\"\n                  :preserve-search=\"true\"\n                  placeholder=\"Selectionnez\"\n                  label=\"name\"\n                  track-by=\"name\"\n                  :preselect-first=\"true\"\n                  @close=\"dispatchAction\"\n                >\n                  <template\n                    slot=\"selection\"\n                    slot-scope=\"{ values, search, isOpen }\"\n                    ><span\n                      class=\"multiselect__single\"\n                      v-if=\"values.length &amp;&amp; !isOpen\"\n                      >{{ values.length }} selections</span\n                    ></template\n                  >\n                </multiselect>\n              </div>\n            </div>\n          </div>\n          <div\n            class=\"is-flex-tablet is-align-items-center is-justify-content-end mb-2 mr-2\"\n          >\n            <div class=\"control is-flex is-flex-grow-2\">\n              <span\n                class=\"is-hidden-mobile is-block-tablet-only is-hidden-widescreen\"\n              >\n                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n              </span>\n              <div class=\"select is-flex-grow-2 is-flex\">\n                <select v-model=\"view\" class=\"is-flex-grow-2\">\n                  <option\n                    v-for=\"(option, index) in viewModeOptions\"\n                    :value=\"option.value\"\n                    :key=\"index\"\n                  >\n                    {{ option.title }}\n                  </option>\n                </select>\n              </div>\n            </div>\n          </div>\n          <label\n            for=\"history\"\n            class=\"label is-flex-tablet is-flex-wrap-wrap is-align-items-center mr-2 mb-2\"\n          >\n            Historique<span class=\"is-hidden-widescreen\"\n              >&nbsp;&nbsp;&nbsp;</span\n            >\n            : &nbsp;\n            <input\n              type=\"checkbox\"\n              id=\"history\"\n              v-model=\"history\"\n              @click=\"dispatchAction\"\n            />\n          </label>\n        </div>\n        <div\n          class=\"is-flex is-flex-wrap-wrap is-justify-content-center is-align-items-center\"\n        >\n          <div class=\"mr-2 mb-2 text-center\">\n            <strong class=\"is-size-5\">{{ renderRange }}</strong>\n          </div>\n          <div class=\"is-flex is-flex-grow-2 is-align-items-center\">\n            <div class=\"mr-2 mb-2\">\n              <button\n                type=\"button\"\n                class=\"button is-flex is-align-items-center is-outlined flat-button\"\n                data-action=\"move-prev\"\n                @click=\"prev()\"\n              >\n                <svg\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  width=\"20\"\n                  height=\"20\"\n                  viewBox=\"0 0 20 20\"\n                  fill=\"currentColor\"\n                >\n                  <path\n                    fill-rule=\"evenodd\"\n                    d=\"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z\"\n                    clip-rule=\"evenodd\"\n                  />\n                </svg>\n              </button>\n            </div>\n            <div class=\"mr-2 mb-2 is-flex-grow-2\">\n              <button\n                type=\"button\"\n                class=\"button is-block is-fullwidth is-outlined flat-button\"\n                data-action=\"move-today\"\n                @click=\"today()\"\n              >\n                Aujourd'hui\n              </button>\n            </div>\n            <div class=\"mr-2 my-2\">\n              <button\n                type=\"button\"\n                class=\"button is-flex is-align-items-center is-outlined flat-button\"\n                data-action=\"move-next\"\n                @click=\"next()\"\n              >\n                <svg\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  width=\"20\"\n                  height=\"20\"\n                  viewBox=\"0 0 20 20\"\n                  fill=\"currentColor\"\n                >\n                  <path\n                    fill-rule=\"evenodd\"\n                    d=\"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z\"\n                    clip-rule=\"evenodd\"\n                  />\n                </svg>\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"column is-12\" id=\"calendar\">\n      <Calendar\n        ref=\"tuiCalendar\"\n        style=\"height: 800px; width: 100%\"\n        :view=\"view\"\n        :calendars=\"calendarList\"\n        v-bind:schedules=\"CscheduleList\"\n        :taskView=\"taskView\"\n        :scheduleView=\"scheduleView\"\n        :theme=\"theme\"\n        :week=\"week\"\n        :month=\"month\"\n        :useCreationPopup=\"useCreationPopup\"\n        :useDetailPopup=\"useDetailPopup\"\n        :timezones=\"timezones\"\n        :disableDblClick=\"disableDblClick\"\n        :isReadOnly=\"isReadOnly\"\n        :template=\"template\"\n        @beforeCreateSchedule=\"onBeforeCreateSchedule\"\n        @beforeDeleteSchedule=\"onBeforeDeleteSchedule\"\n        @beforeUpdateSchedule=\"onBeforeUpdateSchedule\"\n        @clickDayname=\"onClickDayname\"\n        @clickSchedule=\"onClickSchedule\"\n        @clickTimezonesCollapseBtn=\"onClickTimezonesCollapseBtn\"\n      />\n      <div\n        class=\"tui-full-calendar-floating-layer\"\n        id=\"floating-layer-container\"\n        style=\"display: block; position: absolute; z-index: 1000\"\n        v-if=\"selected || creating\"\n      >\n        <div\n          class=\"tui-full-calendar-popup tui-full-calendar-popup-detail\"\n          v-if=\"!editing\"\n        >\n          <div\n            class=\"tui-full-calendar-popup-container\"\n            v-if=\"selected && !editing\"\n          >\n            <div\n              class=\"tui-full-calendar-popup-section tui-full-calendar-section-header\"\n            >\n              <div>\n                <span\n                  class=\"tui-full-calendar-schedule-private tui-full-calendar-icon tui-full-calendar-ic-private\"\n                ></span>\n                <span class=\"tui-full-calendar-schedule-title\">{{\n                  selected.schedule.title\n                }}</span>\n              </div>\n              <div\n                class=\"tui-full-calendar-popup-detail-date tui-full-calendar-content\"\n              >\n                {{\n                  getTemplate().popupDetailDate(\n                    selected.schedule.isAllDay,\n                    selected.schedule.start,\n                    selected.schedule.end\n                  )\n                }}\n              </div>\n            </div>\n            <div class=\"tui-full-calendar-section-detail\">\n              <div\n                class=\"tui-full-calendar-popup-detail-item\"\n                v-if=\"selected.schedule.location\"\n              >\n                <span\n                  class=\"tui-full-calendar-icon tui-full-calendar-ic-location-b\"\n                ></span\n                ><span class=\"tui-full-calendar-content\">{{\n                  getTemplate().popupDetailLocation(selected.schedule)\n                }}</span>\n              </div>\n\n              <div class=\"tui-full-calendar-popup-detail-item\">\n                <span\n                  class=\"tui-full-calendar-icon tui-full-calendar-ic-state-b\"\n                ></span\n                ><span class=\"tui-full-calendar-content\">\n                  {{ getTemplate().popupDetailState(selected.schedule) }}</span\n                >\n              </div>\n              <div class=\"tui-full-calendar-popup-detail-item\">\n                <span\n                  class=\"tui-full-calendar-icon tui-full-calendar-calendar-dot\"\n                  :style=\"{\n                    backgroundColor: getCalendar(selected.schedule.calendarId)\n                      .bgColor,\n                  }\"\n                ></span\n                ><span class=\"tui-full-calendar-content\">{{\n                  getCalendar(selected.schedule.calendarId).name\n                }}</span>\n              </div>\n            </div>\n            <div\n              class=\"tui-full-calendar-section-button\"\n              v-if=\"!selected.schedule.isReadOnly\"\n            >\n              <button class=\"tui-full-calendar-popup-edit\" @click=\"edit()\">\n                <span\n                  class=\"tui-full-calendar-icon tui-full-calendar-ic-edit\"\n                ></span\n                ><span class=\"tui-full-calendar-content\">Modifier</span>\n              </button>\n              <div class=\"tui-full-calendar-popup-vertical-line\"></div>\n              <button\n                class=\"tui-full-calendar-popup-delete\"\n                @click=\"onBeforeDeleteSchedule(selected)\"\n              >\n                <span\n                  class=\"tui-full-calendar-icon tui-full-calendar-ic-delete\"\n                ></span\n                ><span class=\"tui-full-calendar-content\">Supprimer</span>\n              </button>\n            </div>\n          </div>\n          <div\n            class=\"tui-full-calendar-popup-top-line\"\n            :style=\"{\n              backgroundColor: getCalendar(selected.schedule.calendarId)\n                .bgColor,\n            }\"\n            v-if=\"selected && !editing\"\n          ></div>\n          <div\n            id=\"tui-full-calendar-popup-arrow\"\n            class=\"tui-full-calendar-popup-arrow tui-full-calendar-arrow-left\"\n            v-if=\"selected && !editing\"\n          >\n            <div class=\"tui-full-calendar-popup-arrow-border\">\n              <div class=\"tui-full-calendar-popup-arrow-fill\"></div>\n            </div>\n          </div>\n        </div>\n        <vue-friendly-iframe\n          title=\"iframe\"\n          ref=\"editdata\"\n          id=\"tui-full-calendar-popup-iframe\"\n          :src=\"\n            creating\n              ? URI_ACTION_CREATION + '?date_debut=' + dateCreateEvent\n              : URI_ACTION_UPDATE + selected.schedule.id\n          \"\n          \n          width=\"100%\"\n          height=\"100%\"\n          v-if=\"editing || creating\"\n          @load=\"checkingFrame\"\n        />\n      </div>\n    </div>\n  </div>\n</template>\n<script>\nimport { Calendar } from \"@toast-ui/vue-calendar\"; /* ES6 */\nimport \"tui-calendar/dist/tui-calendar.css\";\n// If you use the default popups, use this.\nimport \"tui-date-picker/dist/tui-date-picker.css\";\nimport \"tui-time-picker/dist/tui-time-picker.css\";\n\nimport axios from \"axios\";\n\nimport moment from \"moment\";\n\nimport myTheme from \"./myTheme\";\nimport Multiselect from \"vue-multiselect\";\nimport \"vue-multiselect/dist/vue-multiselect.min.css\";\n\nimport VueFriendlyIframe from \"vue-friendly-iframe\";\n// eslint-disable-next-line no-unused-vars\nconst getDate = (type, start, value, operator) => {\n  start = new Date(start);\n  type = type.charAt(0).toUpperCase() + type.slice(1);\n  if (operator === \"+\") {\n    start[`set${type}`](start[`get${type}`]() + value);\n  } else {\n    start[`set${type}`](start[`get${type}`]() - value);\n  }\n  return start;\n};\nexport default {\n  components: { Calendar, Multiselect, VueFriendlyIframe },\n  props: {\n    API_KEY: {\n      type: String,\n      default() {\n        return \"\";\n      },\n    },\n\n    URI: {\n      type: String,\n      default() {\n        return \"https://0002-zebridge-dev-externe.api.crm-simple.com/interactions/\";\n      },\n    },\n\n    URI_HISTORY: {\n      type: String,\n      default() {\n        return \"https://0002-zebridge-dev-externe.api.crm-simple.com/interactionshistorique/\";\n      },\n    },\n\n    URI_ACTION: {\n      type: String,\n      default() {\n        return \"https://0002-zebridge-dev-externe.api.crm-simple.com/interaction/\";\n      },\n    },\n\n    URI_ACTION_CREATION: {\n      type: String,\n      default() {\n        return \"https://0002-zebridge-dev-externe.crm-simple.com/action_edit.php\";\n      },\n    },\n\n    URI_ACTION_UPDATE: {\n      type: String,\n      default() {\n        return \"https://0002-zebridge-dev-externe.crm-simple.com/action_edit.php?idaction=\";\n      },\n    },\n\n    locale: {\n      type: String,\n      default() {\n        return \"fr-FR\";\n      },\n    },\n\n    calendarList: {\n      type: Array,\n      default() {\n        return [\n          {\n            id: \"0\",\n            name: \"Private\",\n            bgColor: \"#9e5fff\",\n            borderColor: \"#9e5fff\",\n          },\n          {\n            id: \"1\",\n            name: \"Company\",\n            bgColor: \"#00a9ff\",\n            borderColor: \"#00a9ff\",\n          },\n        ];\n      },\n    },\n    USER_API: {\n      type: String,\n      default() {\n        return \"https://0002-zebridge-dev-externe.api.crm-simple.com/utilisateurs/\";\n      },\n    },\n    arrayFilter: {\n      type: Array,\n      default() {\n        return [\n          {\n            color: \"#2251ff\",\n            title: \"Défaut\",\n            index: \"color_defaut\",\n          },\n          {\n            color: \"#ffcedf0\",\n            title: \"Etat\",\n            index: \"color_etat\",\n          },\n          {\n            color: \"#25ffcd\",\n            title: \"Priorité\",\n            index: \"color_priorite\",\n          },\n          {\n            color: \"#de452a\",\n            title: \"Utilisateur\",\n            index: \"color_utilisateur\",\n          },\n          {\n            color: \"#cdee00\",\n            title: \"Type\",\n            index: \"color_type\",\n          },\n          {\n            color: \"#e19400\",\n            title: \"Priorité échéance\",\n            index: \"color_priorite_echeance\",\n          },\n        ];\n      },\n    },\n    idUtilisateurs: {\n      type: Array,\n      default() {\n        return [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\"];\n      },\n    },\n    idprojets: {\n      type: Array,\n      default() {\n        return [];\n      },\n    },\n    idcontacts: {\n      type: Array,\n      default() {\n        return [];\n      },\n    },\n    idsocietes: {\n      type: Array,\n      default() {\n        return [];\n      },\n    },\n    scheduleList: {\n      type: Array,\n      default() {\n        return [];\n      },\n    },\n    viewModeOptions: {\n      type: Array,\n      default() {\n        return [\n          {\n            title: \"Mois\",\n            value: \"month\",\n          },\n          {\n            title: \"Semaine\",\n            value: \"week\",\n          },\n          {\n            title: \"Jour\",\n            value: \"day\",\n          },\n        ];\n      },\n    },\n\n    dateRange: {\n      type: Array,\n      default() {\n        return [moment().subtract(1, \"month\").toDate(), moment().toDate()];\n      },\n    },\n\n    timezones: {\n      type: Array,\n      default() {\n        return [\n          // paris\n          {\n            name: \"Europe/Paris\",\n            label: \"Paris\",\n            offset: \"+01:00\",\n          },\n        ];\n      },\n    },\n\n    month: {\n      type: Object,\n      default() {\n        return {\n          startDayOfWeek: 1,\n          daynames: [\"Dim\", \"Lun\", \"Mar\", \"Mer\", \"Jeu\", \"Ven\", \"Sam\"],\n        };\n      },\n    },\n\n    week: {\n      type: Object,\n      default() {\n        return {\n          showTimezoneCollapseButton: true,\n          timezonesCollapsed: true,\n          daynames: [\"Dim\", \"Lun\", \"Mar\", \"Mer\", \"Jeu\", \"Ven\", \"Sam\"],\n          startDayOfWeek: 1,\n        };\n      },\n    },\n\n    taskView: {\n      type: Boolean,\n      default() {\n        return true;\n      },\n    },\n\n    scheduleView: {\n      type: Array,\n      default() {\n        return [\"time\"];\n      },\n    },\n\n    disableDblClick: {\n      type: Boolean,\n      default() {\n        return true;\n      },\n    },\n\n    isReadOnly: {\n      type: Boolean,\n      default() {\n        return false;\n      },\n    },\n\n    // view: {\n    //   type: String,\n    //   default() {\n    //     return \"month\";\n    //   },\n    // },\n    useCreationPopup: {\n      type: Boolean,\n      default() {\n        return false;\n      },\n    },\n    useDetailPopup: {\n      type: Boolean,\n      default() {\n        return false;\n      },\n    },\n  },\n  data() {\n    return {\n      users: [],\n      selectedUsers: [],\n      editing: false,\n      history: false,\n      creating: false,\n      clickCount: 0,\n      selected: null,\n      isFullPage: false,\n      isLoading: true,\n      info: null,\n      event: null,\n      view: \"month\",\n      isComponentModalActive: false,\n      renderRange: null,\n      startDate: \"\",\n      endDate: \"\",\n      dateCreateEvent: \"\",\n      form: {\n        sujet: \"\",\n        color: \"\",\n        date_debut: \"\",\n        date_fin: \"\",\n\n        submit: false,\n      },\n      errors: {\n        sujet: \"Le champs titre est obligatoire\",\n        date_debut: \"Le date debut est obligatoire\",\n        date_fin: \"Le date fin est obligatoire\",\n        color: \"Le champs couleur est obligatoire\",\n      },\n      template: this.getTemplate(),\n      theme: myTheme,\n      CscheduleList: [],\n      showing: \"\",\n      typeview: {\n        title: \"Selectionnez\",\n        color: \"#2251ff\",\n        index: \"color_defaut\",\n      },\n    };\n  },\n\n  methods: {\n    show() {\n      this.showing = this.showing.length === 0 ? \"is-active\" : \"\";\n    },\n\n    setView(type) {\n      this.typeview = type;\n      this.show(); // show or hide the dropdown\n\n      this.dispatchAction();\n    },\n    isUserSelected(idUser) {\n      return this.idUtilisateurs.find(idUser) > 0;\n    },\n    async loadUsers() {\n      await axios({\n        method: \"get\",\n        url: this.USER_API + this.API_KEY,\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n      })\n        .then((response) => {\n          if (response.data.result === 1) {\n            this.users = response.data.data.map((el) => {\n              return {\n                id: el.idutilisateur.value.toString(),\n                name: el.nom_utilisateur.value.toString(),\n              };\n            });\n            this.selectedUsers = this.users.filter(\n              (x) => x.id in this.idUtilisateurs\n            );\n          } else {\n            console.log(response.data.err_message);\n          }\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    },\n    async dispatchAction() {\n      this.isLoading = true;\n\n      // callinf fisrt route\n      this.CscheduleList = await this.getCalendarItem(0, false).then(\n        (items) => {\n          return items.flat(Infinity);\n        }\n      );\n\n      // 2 route onDueDate is true\n      this.CscheduleList = this.CscheduleList.concat(\n        await this.getCalendarItem(0, true).then((items) => {\n          return items.flat(Infinity);\n        })\n      );\n\n      // calling third route\n      if (this.history) {\n        this.CscheduleList = this.CscheduleList.concat(\n          await this.getIteractionsHistory(0).then((historyItems) => {\n            return historyItems.flat(Infinity);\n          })\n        );\n      }\n      this.isLoading = false;\n    },\n\n    setColor(type, data) {\n      let color = type.color;\n      try {\n        const jsondata = data.color.value;\n        color = JSON.parse(jsondata)[type.index];\n      } catch (error) {\n        console.log(\"undefined color data\");\n      }\n\n      return color;\n    },\n    getTemplate() {\n      const th = this;\n      return {\n        milestone: function (schedule) {\n          return (\n            '<span class=\"calendar-font-icon ic-milestone-b\"></span> <span style=\"background-color: ' +\n            schedule.bgColor +\n            '\">' +\n            schedule.title +\n            \"</span>\"\n          );\n        },\n        milestoneTitle: function () {\n          return '<span class=\"tui-full-calendar-left-content\">ETAPE</span>';\n        },\n        task: function (schedule) {\n          return \"#\" + schedule.title;\n        },\n        taskTitle: function () {\n          return '<span class=\"tui-full-calendar-left-content\">TACHE</span>';\n        },\n        allday: function (schedule) {\n          return th._getTimeTemplate(schedule, true);\n        },\n        alldayTitle: function () {\n          return '<span class=\"tui-full-calendar-left-content\"> Toute la journée</span>';\n        },\n        time: function (schedule) {\n          return th._getTimeTemplate(schedule, false);\n        },\n        goingDuration: function (schedule) {\n          return (\n            '<span class=\"calendar-icon ic-travel-time\"></span>' +\n            schedule.goingDuration +\n            \"min.\"\n          );\n        },\n        comingDuration: function (schedule) {\n          return (\n            '<span class=\"calendar-icon ic-travel-time\"></span>' +\n            schedule.comingDuration +\n            \"min.\"\n          );\n        },\n        monthMoreTitleDate: function (date, dayname) {\n          var day = date.split(\".\")[2];\n\n          return (\n            '<span class=\"tui-full-calendar-month-more-title-day\">' +\n            day +\n            '</span> <span class=\"tui-full-calendar-month-more-title-day-label\">' +\n            dayname +\n            \"</span>\"\n          );\n        },\n        monthMoreClose: function () {\n          return '<span class=\"tui-full-calendar-icon tui-full-calendar-ic-close\"></span>';\n        },\n        monthGridHeader: function (dayModel) {\n          var date = parseInt(dayModel.date.split(\"-\")[2], 10);\n          var classNames = [\"tui-full-calendar-weekday-grid-date \"];\n\n          if (dayModel.isToday) {\n            classNames.push(\"tui-full-calendar-weekday-grid-date-decorator\");\n          }\n\n          return (\n            '<span class=\"' + classNames.join(\" \") + '\">' + date + \"</span>\"\n          );\n        },\n        monthGridHeaderExceed: function (hiddenSchedules) {\n          return (\n            '<span class=\"weekday-grid-more-schedules\">+' +\n            hiddenSchedules +\n            \"</span>\"\n          );\n        },\n        monthGridFooter: function () {\n          return \"\";\n        },\n        monthGridFooterExceed: function () {\n          return \"\";\n        },\n        monthDayname: function (model) {\n          return model.label.toString().toLocaleUpperCase();\n        },\n        weekDayname: function (model) {\n          return (\n            '<span class=\"tui-full-calendar-dayname-date\">' +\n            model.date +\n            '</span>&nbsp;&nbsp;<span class=\"tui-full-calendar-dayname-name\">' +\n            model.dayName +\n            \"</span>\"\n          );\n        },\n        weekGridFooterExceed: function (hiddenSchedules) {\n          return \"+\" + hiddenSchedules;\n        },\n        dayGridTitle: function (viewName) {\n          // use another functions instead of 'dayGridTitle'\n          // milestoneTitle: function() {...}\n          // taskTitle: function() {...}\n          // alldayTitle: function() {...}\n\n          var title = \"\";\n          switch (viewName) {\n            case \"milestone\":\n              title =\n                '<span class=\"tui-full-calendar-left-content\">ETAPE</span>';\n              break;\n            case \"task\":\n              title =\n                '<span class=\"tui-full-calendar-left-content\">TACHE</span>';\n              break;\n            case \"allday\":\n              title =\n                '<span class=\"tui-full-calendar-left-content\">Toute la journée</span>';\n              break;\n            default:\n              break;\n          }\n\n          return title;\n        },\n\n        collapseBtnTitle: function () {\n          return '<span class=\"tui-full-calendar-icon tui-full-calendar-ic-arrow-solid-top\"></span>';\n        },\n\n        timegridDisplayPrimayTime: function (time) {\n          // will be deprecated. use 'timegridDisplayPrimaryTime'\n          return time.hour.toString();\n        },\n        timegridCurrentTime: function (timezone) {\n          var templates = [];\n\n          if (timezone.dateDifference) {\n            templates.push(\n              \"[\" +\n                timezone.dateDifferenceSign +\n                timezone.dateDifference +\n                \"]<br>\"\n            );\n          }\n\n          templates.push(moment(timezone.hourmarker).format(\"HH:mm\"));\n\n          return templates.join(\"\");\n        },\n        popupIsAllDay: function () {\n          return \"Toute la journée\";\n        },\n        popupStateFree: function () {\n          return \"Libre\";\n        },\n        popupStateBusy: function () {\n          return \"Occupé\";\n        },\n        titlePlaceholder: function () {\n          return \"Sujet\";\n        },\n        locationPlaceholder: function () {\n          return \"Lieu\";\n        },\n        startDatePlaceholder: function () {\n          return \"Date de Début\";\n        },\n        endDatePlaceholder: function () {\n          return \"Date de fin\";\n        },\n        popupSave: function () {\n          return \"Valider\";\n        },\n        popupUpdate: function () {\n          return \"Mettre à jour\";\n        },\n        popupDetailDate: function (isAllDay, start, end) {\n          var isSameDate = moment(start).isSame(end);\n          var endFormat = (isSameDate ? \"\" : \"YYYY/MM/DD \") + \"HH:mm\";\n\n          if (isAllDay) {\n            return (\n              moment(start).format(\"YYYY/MM/DD\") +\n              (isSameDate ? \"\" : \" - \" + moment(end).format(\"YYYY/MM/DD\"))\n            );\n          }\n\n          return (\n            moment(start.toDate()).format(\"YYYY/MM/DD HH:mm\") +\n            \" - \" +\n            moment(end.toDate()).format(endFormat)\n          );\n        },\n        popupDetailLocation: function (schedule) {\n          return \"Lieu : \" + schedule.location;\n        },\n        // popupDetailUser: function (schedule) {\n        // \treturn 'Staff : ' + (schedule.attendees || []).join(', ')\n        // },\n        popupDetailState: function (schedule) {\n          return \" Statut: \" + schedule.state === \"Free\" ? \"Libre\" : \"Occupé\";\n        },\n        popupDetailRepeat: function (schedule) {\n          return \"Repeat : \" + schedule.recurrenceRule;\n        },\n        popupDetailBody: function (schedule) {\n          return \"Body : \" + schedule.body;\n        },\n        popupEdit: function () {\n          return \"Modifier\";\n        },\n        popupDelete: function () {\n          return \"Supprimer\";\n        },\n      };\n    },\n    _getTimeTemplate(schedule, isAllDay) {\n      var html = [];\n\n      if (!isAllDay) {\n        html.push(\n          \"<strong>\" +\n            moment(schedule.start.toDate()).format(\"HH:mm\") +\n            \"</strong> \"\n        );\n      }\n      if (schedule.isPrivate) {\n        html.push('<span class=\"calendar-font-icon ic-lock-b\"></span>');\n        html.push(\" Private\");\n      } else {\n        if (schedule.isReadOnly) {\n          html.push('<span class=\"calendar-font-icon ic-readonly-b\"></span>');\n        } else if (schedule.recurrenceRule) {\n          html.push('<span class=\"calendar-font-icon ic-repeat-b\"></span>');\n        } else if (schedule.attendees.length) {\n          html.push('<span class=\"calendar-font-icon ic-user-b\"></span>');\n        } else if (schedule.location) {\n          html.push('<span class=\"calendar-font-icon ic-location-b\"></span>');\n        }\n\n        html.push(\" \" + schedule.title);\n      }\n\n      return html.join(\"\");\n    },\n\n    setRenderRangeText() {\n      let options = this.$refs.tuiCalendar.invoke(\"getOptions\");\n      let viewName = this.$refs.tuiCalendar.invoke(\"getViewName\");\n      let html = [];\n      this.startDate = this.$refs.tuiCalendar\n        .invoke(\"getDateRangeStart\")\n        .toDate()\n        .toLocaleDateString(\"fr-CA\");\n      this.endDate = this.$refs.tuiCalendar\n        .invoke(\"getDateRangeEnd\")\n        .toDate()\n        .toLocaleDateString(\"fr-CA\");\n\n      if (viewName === \"day\") {\n        html.push(this.currentCalendarDate(\"DD MMMM YYYY\"));\n      } else if (\n        viewName === \"month\" &&\n        (!options.month.visibleWeeksCount ||\n          options.month.visibleWeeksCount > 4)\n      ) {\n        html.push(this.currentCalendarDate(\"MMMM YYYY\"));\n      } else {\n        let time = moment(\n          this.$refs.tuiCalendar.invoke(\"getDateRangeStart\").getTime()\n        );\n\n        let currentdate = new Date(time);\n        let oneJan = new Date(currentdate.getFullYear(), 0, 1);\n        let numberOfDays = Math.floor(\n          (currentdate - oneJan) / (24 * 60 * 60 * 1000)\n        );\n        let result = Math.ceil((currentdate.getDay() + 1 + numberOfDays) / 7);\n        html.push(\n          \"Semaine \" +\n            result +\n            \" | \" +\n            moment(this.$refs.tuiCalendar.invoke(\"getDateRangeStart\").getTime())\n              .locale(this.locale)\n              .format(\"DD MMMM YYYY\")\n        );\n        html.push(\" - \");\n        html.push(\n          moment(this.$refs.tuiCalendar.invoke(\"getDateRangeEnd\").getTime())\n            .locale(this.locale)\n            .format(\"DD MMMM YYYY\")\n        );\n      }\n      this.renderRange = html.join(\"\");\n    },\n    generateQueryFor(dataArray, dataParam, result) {\n      if (dataArray.length > 0) {\n        result = result.concat(\n          result.length === 0 ? \"condition:\" : \":separator:AND:condition:\",\n          this.setfilter(dataArray, dataParam)\n        );\n      }\n      return result;\n    },\n    getQueryParam(dateFilter = \"date_action\") {\n      /**\n       *@param none\n       *@author Jacques\n       *@Resume : figure out  filter on API request\n       *@example : condition:idutilisateur:egal:1:OR:idutilisateur:egal:4:separator:AND:condition:idprojet:egal:1:OR:idprojet:egal:4060:separator:AND:condition:idsociete:egal:4:OR:idsociete:egal:2234\n       **/\n\n      let filter = \"\";\n      // filtering users\n      if (this.selectedUsers.length > 0) {\n        filter = filter.concat(\n          filter.length === 0 ? \"condition:\" : \":separator:AND:condition:\",\n          this.setfilter(\n            this.selectedUsers.map((e) => {\n              return e.id;\n            }),\n            \"idutilisateur\"\n          )\n        );\n      }\n\n      // idprojet\n      if (this.idprojets.length > 0) {\n        filter = filter.concat(\n          filter.length === 0 ? \"condition:\" : \":separator:AND:condition:\",\n          this.setfilter(this.idprojets, \"idprojet\")\n        );\n      }\n\n      // idcontact\n      if (this.idcontacts.length > 0) {\n        filter = filter.concat(\n          filter.length === 0 ? \"condition:\" : \":separator:AND:condition:\",\n          this.setfilter(this.idcontacts, \"idcontact\")\n        );\n      }\n\n      // idsociete\n      if (this.idsocietes.length > 0) {\n        filter = filter.concat(\n          filter.length === 0 ? \"condition:\" : \":separator:AND:condition:\",\n          this.setfilter(this.idsocietes, \"idsociete\")\n        );\n      }\n\n      // Setting condition on Dates\n\n      filter = filter.concat(\n        filter.length === 0 ? \"condition:\" : \":separator:AND:condition:\",\n        dateFilter +\n          \":biggerthanoregal:\" +\n          this.startDate +\n          \":AND:\" +\n          dateFilter +\n          \":lowerthanoregal:\" +\n          this.endDate\n      );\n\n      return filter;\n    },\n    setfilter(listArray, param) {\n      if (listArray.length === 1) {\n        return param + \":egal:\" + listArray[0];\n      } else {\n        return (\n          param +\n          \":egal:\" +\n          listArray[0] +\n          \":OR:\" +\n          this.setfilter(listArray.slice(1), param)\n        );\n      }\n    },\n\n    async getCalendarItem(nbPage = 0, onDueDate = false) {\n      return axios({\n        method: \"get\",\n        url:\n          this.URI +\n          this.API_KEY +\n          \"/\" +\n          this.getQueryParam(onDueDate ? \"date_echeance\" : \"date_action\") +\n          \"/\" +\n          nbPage,\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n      }).then((response) => {\n        if (response.data.data.length > 0) {\n          let result = response.data.data.map((element) => {\n            return {\n              start: element.date_action.value,\n              end: element.date_fin.value,\n              isReadOnly: element.e_lock.value === \"1\",\n              location: element.location.value,\n              idaction: element.idaction.value,\n              title: element.sujet.value,\n              bgColor:\n                onDueDate && this.typeview.index != \"color_priorite\"\n                  ? \"#f2a640\"\n                  : this.setColor(this.typeview, element),\n              category: \"time\",\n              dueDateClass: element.date_echeance.value,\n              id: element.idaction.value.toString(),\n              calendarId:\n                this.getCalendarIdWithColor(element.color.value) || \"0\",\n            };\n          });\n          return Promise.all([\n            ...result,\n            this.getCalendarItem(++nbPage, onDueDate),\n          ]);\n        } else {\n          return [];\n        }\n      });\n    },\n    async getIteractionsHistory(nbPage = 0) {\n      return axios({\n        method: \"get\",\n        url:\n          this.URI_HISTORY +\n          this.API_KEY +\n          \"/\" +\n          this.getQueryParam() +\n          \"/\" +\n          nbPage,\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n      }).then((response) => {\n        if (response.data.data.length > 0) {\n          //let index = 0;\n          let result = response.data.data.map((element) => {\n            return {\n              start: element.date_action.value,\n              end: element.date_fin.value,\n              isReadOnly: element.e_lock.value === \"1\",\n              location: element.location.value,\n              idaction: element.idaction.value,\n              //   state: element.etat.value === 0 ? \"Busy\" : \"Free\",\n              title: element.sujet.value,\n              bgColor: \"#8cbf40\", // this.setColor(this.typeview, element),\n              category: \"time\",\n              // color: this.setColor(this.typeview, element),\n              dueDateClass: element.date_echeance.value,\n              id: element.idaction.value.toString(),\n              calendarId:\n                this.getCalendarIdWithColor(element.color.value) || \"0\",\n            };\n          });\n          return Promise.all([...result, this.getIteractionsHistory(++nbPage)]);\n        } else {\n          return [];\n        }\n      });\n    },\n    currentCalendarDate(format) {\n      var currentDate = moment([\n        this.$refs.tuiCalendar.invoke(\"getDate\").getFullYear(),\n        this.$refs.tuiCalendar.invoke(\"getDate\").getMonth(),\n        this.$refs.tuiCalendar.invoke(\"getDate\").getDate(),\n      ]);\n\n      // first letter uppercase\n      return (\n        currentDate.locale(this.locale).format(format).charAt(0).toUpperCase() +\n        currentDate.locale(this.locale).format(format).slice(1)\n      );\n    },\n    getCalendarWithColor(color) {\n      // get index\n      let index = this.calendarList.findIndex(\n        (element) => element.bgColor === color\n      );\n      // return calendar\n      return this.calendarList[index]?.bgColor || \"#FFF\";\n    },\n    getCalendarIdWithColor(color) {\n      // get index\n      let index = this.calendarList.findIndex(\n        (element) => element.bgColor === color\n      );\n      // return calendar\n      return this.calendarList[index]?.id;\n    },\n    getToday() {\n      this.$refs.tuiCalendar.invoke(\"today\");\n      this.setRenderRangeText();\n      this.dispatchAction();\n    },\n    next() {\n      this.$refs.tuiCalendar.invoke(\"next\");\n      this.setRenderRangeText();\n      this.dispatchAction();\n    },\n    prev() {\n      this.$refs.tuiCalendar.invoke(\"prev\");\n      this.setRenderRangeText();\n      this.dispatchAction();\n    },\n    today() {\n      this.$refs.tuiCalendar.invoke(\"today\");\n      this.setRenderRangeText();\n      this.dispatchAction();\n    },\n    changeView(viewName) {\n      this.$refs.tuiCalendar.invoke(\"changeView\", viewName);\n    },\n    onClickSchedule(res) {\n      this.selected = res;\n\n      // set more card to display none\n      let card = document.getElementsByClassName(\n        \"tui-full-calendar-month-more\"\n      );\n      card[0].style.display = \"none\";\n    },\n    onClickDayname(res) {\n      // view : week, day\n      console.group(\"onClickDayname\");\n      console.log(res.date);\n      console.groupEnd();\n    },\n\n    onBeforeCreateSchedule(e) {\n      this.event = e;\n      const eventDate = e.start.toDate();\n      this.dateCreateEvent =\n        eventDate.toLocaleDateString(\"fr-CA\") +\n        \"_\" +\n        (eventDate.getHours() < 10 ? \"0\" : \"\") +\n        eventDate.getHours() +\n        \"-\" +\n        (eventDate.getMinutes() < 10 ? \"0\" : \"\") +\n        eventDate.getMinutes();\n      e.guide.clearGuideElement();\n      this.clickCount = this.clickCount === 0 ? 1 : 0;\n      this.creating = this.clickCount === 0;\n      setTimeout(() => {\n        this.openIframeEditor();\n      }, 50);\n    },\n    onBeforeUpdateSchedule(e) {\n      var em = this;\n\n      let schedule = this.CscheduleList.find(\n        (element) => element.id === e.schedule.id\n      );\n\n      e.schedule.start = e.start;\n      e.schedule.end = e.end;\n      schedule.calendarId = e.changes.calendarId || e.schedule.calendarId;\n      schedule.title = e.changes.title || e.schedule.title;\n      schedule.category = e.changes.isAllDay\n        ? \"allday\"\n        : \"time\" || e.changes.category;\n\n      schedule.start = e.start;\n      schedule.end = e.end;\n      schedule.isReadOnly = e.changes.isPrivate || e.changes.isReadOnly;\n      schedule.location = e.changes.location || e.schedule.location;\n      schedule.bgColor =\n        this.calendarList[\n          e.changes.calendarId || e.schedule.calendarId\n        ].bgColor;\n\n      var t = new Date(e.schedule.start).toISOString();\n      t = String(t).replace(\"T\", \" \");\n      t = String(t).replace(\".000Z\", \"\");\n\n      const time_difference = e.end.getTime() - e.start.getTime();\n      //calculate days difference by dividing total milliseconds in a day\n      const hours = Math.floor(time_difference / (1000 * 60 * 60));\n      const remaining_milliseconds = time_difference % (1000 * 60 * 60);\n      const minutes = Math.floor(remaining_milliseconds / (1000 * 60));\n\n      var config = {\n        method: \"put\",\n        url: this.URI_ACTION + this.API_KEY,\n\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        data: JSON.stringify({\n          idaction: schedule.idaction,\n          sujet: schedule.title,\n          all_day: schedule.category == \"allday\" ? 1 : 0,\n          date_action: t,\n          duree_heures: hours,\n          duree_minutes: minutes,\n          location: schedule.location,\n          //    etat: schedule.state == \"Busy\" ? 1 : 0,\n          color: schedule.bgColor,\n          e_lock: schedule.isReadOnly ? 1 : 0,\n        }),\n      };\n\n      axios(config).then(function () {\n        em.CscheduleList = em.CscheduleList.map((element) =>\n          element.id !== e.schedule.id\n            ? element\n            : {\n                ...element,\n                ...schedule,\n              }\n        );\n\n        em.$refs.tuiCalendar.invoke(\"updateSchedule\", e.schedule.id, schedule);\n      });\n    },\n\n    onBeforeDeleteSchedule(e) {\n      this.selected = null;\n\n      var idaction = this.CscheduleList.find((element) => {\n        return element.id === e.schedule.id;\n      })?.idaction;\n\n      var config = {\n        method: \"delete\",\n        url: this.URI_ACTION + this.API_KEY + \"/\" + idaction,\n        headers: {},\n      };\n\n      axios(config).then(() => {\n        // remove in scheduleList\n        this.CscheduleList = this.CscheduleList.filter(\n          (element) => element.id !== e.schedule.id\n        );\n        this.$refs.tuiCalendar.invoke(\n          \"deleteSchedule\",\n          e.schedule.id,\n          e.schedule.calendarId\n        );\n      });\n    },\n    //Suppression des taches\n    onClickTimezonesCollapseBtn(timezonesCollapsed) {\n      // view : week, day\n      if (timezonesCollapsed) {\n        this.theme[\"week.timegridLeft.width\"] = \"100px\";\n        this.theme[\"week.daygridLeft.width\"] = \"100px\";\n      } else {\n        this.theme[\"week.timegridLeft.width\"] = \"50px\";\n        this.theme[\"week.daygridLeft.width\"] = \"50px\";\n      }\n    },\n    getCalendar(calendarId) {\n      return this.calendarList.find((calendar) => calendar.id === calendarId);\n    },\n    openIframeEditor() {\n      // create div card by getelementbyid\n      let card = document.getElementById(\"floating-layer-container\");\n\n      // set 2/3 width of screen to card only on desktop\n      if (card != null) {\n        if (window.innerWidth > 768) {\n          card.style.width = \"calc(100% - 250px)\";\n          card.style.height = \"calc(100% - 250px)\";\n          card.style.left = \"calc(50% - (calc(100% - 250px) / 2))\";\n          card.style.top = \"calc(50% - (calc(100% - 250px) / 2))\";\n        } else {\n          card.style.width = \"calc(100% - 150px)\";\n          card.style.left = \"calc(50% - (calc(100% - 150px) / 2))\";\n          card.style.top = \"calc(50% - (calc(100% - 800px) / 2))\";\n          card.style.height = \"calc(100% - 150px)\";\n        }\n      }\n    },\n    checkingFrame(e) {\n      console.log(\"message\");\n      console.log(e);\n      console.log(this.$refs.editdata);\n    },\n    edit() {\n      this.editing = true;\n      this.openIframeEditor();\n    },\n    iframeLoaded() {\n      // get iframe document\n      let iframe = document.getElementById(\"tui-full-calendar-popup-iframe\");\n\n      // check url\n      if (\n        iframe &&\n        iframe.contentWindow.location.href.includes(\"/action.php\")\n      ) {\n        this.editing = false;\n        this.creating = false;\n        this.selected = null;\n      }\n    },\n  },\n  watch: {\n    view(value) {\n      this.changeView(value);\n      this.setRenderRangeText();\n    },\n    selected(content) {\n      setTimeout(() => {\n        this.editing = false;\n        let event = null;\n        if (content && content.event) {\n          event = content.event;\n          // get position from event\n          const position = {\n            top: event.pageY - event.target.offsetTop,\n            left: event.pageX - event.target.offsetLeft,\n          };\n\n          // get div card by getelementbyid\n          let card = document.getElementById(\"floating-layer-container\");\n\n          // set position from event mouse to card\n          if (card) {\n            card.style.top = `calc(${position.top}px - 80px)`;\n            card.style.left = `calc(${position.left}px + 25px)`;\n          }\n        }\n      }, 100);\n    },\n  },\n  async mounted() {\n    this.getTemplate();\n    await this.loadUsers(); // loading users list*\n    this.setRenderRangeText();\n    this.dispatchAction(); // Load and set calendat item;\n\n    // click outslide to close card\n    document.addEventListener(\"click\", (e) => {\n      // if click outslide\n      if (\n        (document.getElementById(\"calendar\").contains(e.target) === false &&\n          !this.editing) ||\n        (e.target.className !== \"tui-full-calendar-weekday-schedule\" &&\n          e.target.className !== \"tui-full-calendar-weekday-schedule-title\" &&\n          e.target.className.includes(\"tui-full-calendar-weekday-grid-line\") &&\n          e.target.className ===\n            \"tui-full-calendar-weekday-schedule-content\") ||\n        e.target.className.includes(\n          \"tui-full-calendar-time-date-schedule-block-wrap\"\n        ) ||\n        ((e.target.className.includes(\"tui-full-calendar-weekday-schedule\") ||\n          e.target.className.includes(\n            \"tui-full-calendar-weekday-schedule-content\"\n          ) ||\n          e.target.className.includes(\"tui-full-calendar-weekday-grid-line\") ||\n          e.target.className.includes(\n            \"tui-full-calendar-time-date-schedule-block-wrap\"\n          )) &&\n          this.editing) ||\n        ((e.target.className.includes(\"tui-full-calendar-weekday-grid-line\") ||\n          e.target.className.includes(\n            \"tui-full-calendar-time-date-schedule-block-wrap\"\n          )) &&\n          this.editing &&\n          this.creating)\n      ) {\n        this.editing = false;\n        this.creating = false;\n        this.selected = null;\n        if (this.clickCount === 1) this.clickCount === 2;\n        if (this.clickCount === 2) this.clickCount === 0;\n      } else if (\n        this.selected !== null &&\n        e.target.className !== \"tui-full-calendar-weekday-schedule-title\" &&\n        e.target.className !==\n          \"tui-full-calendar-time-schedule-content tui-full-calendar-time-schedule-content-time\" &&\n        !this.editing\n      ) {\n        this.selected = null;\n        if (this.clickCount === 1) this.clickCount === 2;\n        if (this.clickCount === 2) this.clickCount === 0;\n      } else if (\n        e.target.className === \"tui-full-calendar-weekday-schedule-title\" ||\n        e.target.className ===\n          \"tui-full-calendar-time-schedule-content tui-full-calendar-time-schedule-content-time\"\n      ) {\n        this.creating = false;\n        if (this.clickCount === 1) this.clickCount === 2;\n        if (this.clickCount === 2) this.clickCount === 0;\n      }\n    });\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"@/variables.scss\";\n</style>\n"]}]}